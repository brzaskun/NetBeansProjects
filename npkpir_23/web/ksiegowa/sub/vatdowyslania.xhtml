<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ft="http://primefaces.prime.com.tr/facestrace"
    xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:form>
        <p:ajaxStatus style="width:64px;height:64px;position:fixed;right:250px;bottom:250px">
            <f:facet name="start"><p:graphicImage url="/resources/images/ajax_loaderc.gif"/></f:facet>
            <f:facet name="success"><h:outputText value="Skonczono" /></f:facet>
            <f:facet name="error">Wystąpił nieoczekiewany błąd. Dane nie zostały utracone. Przejdź do strony logowania i zaloguj się ponownie</f:facet>
        </p:ajaxStatus>
    </h:form>   
    <h:form id="formX">
        
        <p:growl id="msg"/>
        <p:panel header="Wykaz oczekujacych wysyłki deklaracji"/>
        <p:dataTable value="#{deklaracjevatView.oczekujace}" var="item" sortBy="#{item.miesiac}"  id="dokumentyLista" emptyMessage="brak deklaracji do wyslania">
            <p:ajax event="rowEdit" update=":formX:msg" listener="#{deklaracjevatView.edit}" />
            <p:column headerText="deklaracja za okres" width="100">
                <h:outputText value="#{item.rok}#{item.rok != null ? '/' : null}#{item.miesiac}"/>
            </p:column>
            <p:column headerText="wersja" width="60">
                <h:outputText value="#{item.wzorschemy}"/>
            </p:column>
            <p:column headerText="podatnik" width="200">
                <h:outputText value="#{item.podatnik}"/>
            </p:column>
            <p:column headerText="dane">
                <p:dataGrid columns="1" value="#{item.selected}" var="loop">
                    <h:panelGrid columns="2">
                    <h:outputText value="rodzaj deklaracji"/><h:outputText value="#{loop.rodzajdeklaracji}"/>
                    <h:outputText value="miesięczna/kwartalna"/><h:outputText value="#{item.miesiackwartal eq false ? 'miesięczna' : 'kwartalna'}"/>
                    <h:outputText value="pierw./kor."/><h:outputText value="#{loop.celzlozenia eq 1 ? 'pierwotna' : 'korekta'}"/>
                    <h:outputText value="nazwa urzędu"/><h:outputText value="#{loop.nazwaurzedu}"/>
                    </h:panelGrid>
                    <h:panelGrid columns="4">
                     <h:outputText value="należny (p.46)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI46}" style="float: right;">
                          <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                     <h:outputText value="naliczony (p.55)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI55}" style="float: right;">
                          <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                    <h:outputText value="przeniesienie (p.47)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI47}" style="float: right;">
                          <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                    <h:outputText value="do zapłaty (p.58)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI58}" style="float: right;">
                          <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                    <h:outputText value="do zwrotu(p.60)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI60}" style="float: right;">
                          <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                    <h:outputText value="kwota autoryzacyjna"/><h:outputText value="#{loop.kwotaautoryzacja}" style="float: right;">
                          <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                    </h:panelGrid>
                </p:dataGrid>
            </p:column>
            <p:column id="previewColumn" headerText="podgląd" width="70">
                <p:commandButton value="Pdf" action="/ksiegowa/ksiegowaVatdowysylki.xhtml?faces-redirect=true" actionListener="#{pdfVAT7.drukujwys(item)}" style="margin-left: 10px;" oncomplete="wydrukvat7('#{item.podatnik}');"/>
            </p:column>
            <p:column id="deleteColumn" headerText="usuń" width="70">
                <p:commandButton actionListener="#{deklaracjevatView.destroy(item)}" onclick="confirmation.show()" id="delete" icon="ui-icon ui-icon-trash" type="submit"/>
            </p:column>
        </p:dataTable>
    </h:form><br/>
    <h:form id="zalacznik">
        <p:panel header="Załącznik ORD-ZU" rendered="#{deklaracjevatView.oczekujace.size()>0 ? (deklaracjevatView.oczekujace.get(0).selected.celzlozenia eq 2 ? true : false) : false}">
             <h:outputText value="Załącznik podpięty." rendered="#{deklaracjevatView.oczekujace.get(0).deklaracja.contains('Zalacznik')}"/>
            <p:panelGrid columns="1"  rendered="#{!deklaracjevatView.oczekujace.get(0).deklaracja.contains('Zalacznik')}">
            <h:outputText value="Przygotowana korekta deklaracji nie zawiera wyjaśnienia przyczyny korekty, nie może być wysłana!"/>
            <h:inputTextarea rows="5" style="width: 900px;" value="#{vat7ORDZUView.trescwyjasnienia}"/>
            <p:commandButton value="Załącz" actionListener="#{vat7ORDZUView.dodajzalacznikORDZAU()}" update="@all"/>
            </p:panelGrid>
        </p:panel>
    </h:form>
    <h:form>
        <p:panel header="wysyłka">
        <p:commandButton value="wyślij" actionListener="#{beanek.rob(deklaracjevatView.oczekujace)}" update=":form:upoform" style="width: 120px;"/>
        <p:commandButton value="test" actionListener="#{beanek.robtest(deklaracjevatView.oczekujace)}" update=":form:upoform" style="margin-left: 30px; width: 120px;"/><br/><br/>
        <h:outputText value="short instrakszyn: "/>
        <p:panelGrid columns="2">
            <h:outputText value="wysylanie: "/>
            <h:outputText value="W celu wysłania deklaracji na serwer ministerstwa wciśnij przycisk wyślij"/>
            <h:outputText value="testowanie"/>
            <h:outputText value="Można też przetestować wysyłke deklaracji. Jeżeli 'nie przejdzie', oznacza to błąd w danych autoryzujących"/>
            <h:outputText value="potwierdzenie"/>
            <h:outputText value="Każdorazowo, celem uzyskania potwierdzenia, należy odpowiednio kliknąć na przycisk upo lub sprawdz"/>
        </p:panelGrid>
        </p:panel>
    </h:form>
    <br/>
    <h:form id="form">
        <p:commandButton value="upo" actionListener="#{beanek.pobierz()}" update=":formX:msg" style="width: 120px;"/>
        <p:commandButton value="sprawdź" actionListener="#{beanek.pobierztest()}" update=":form:upo, :form:stat, :form:opis, :formX:msg" style="margin-left: 30px; width: 120px;"/><br/><br/>
        <p:panelGrid columns="2" id="upoform" style="width: 50%;">
            <h:outputText value="id przesyłki" style="width: 10%;"/>
            <h:inputText value="#{beanek.idpobierz}" style="width: 90%;"/>
            <h:outputText value="UPO" style="width: 10%;"/>
            <h:inputTextarea id="upo" value="#{beanek.upoMB}" readonly="true" style="width: 90%; height: 60px;"/>
            <h:outputText value="status przesyłki - symbol"/>
            <h:outputText id="stat" value="#{beanek.statMB}"/>
            <h:outputText value="opis statusu przesyłki" style="width: 10%;"/>
            <h:inputTextarea id="opis" value="#{beanek.opisMB}" readonly="true" style="width: 90%; height: 60px;"/>
        </p:panelGrid>
    </h:form>
</ui:composition>   


