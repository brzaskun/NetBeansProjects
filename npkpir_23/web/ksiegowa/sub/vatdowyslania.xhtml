<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ft="http://primefaces.prime.com.tr/facestrace"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
        
    xmlns:bcf="http://brzaskun.com/facelets">

    <h:form id="formX">
        <p:growl id="msg" autoUpdate="true"/>
        <p:panel header="Wykaz oczekujacych wysyłki deklaracji" style="max-width: 1400px;"/>
        <p:dataTable value="#{deklaracjevatView.oczekujace}" var="item" sortBy="#{item.miesiac}"  id="dokumentyLista" emptyMessage="brak oczekujących deklaracji do wyslania" style="max-width: 1400px;">
            <p:column style="width: 3%;">
                <p:rowToggler/>
            </p:column>
            <p:ajax event="rowEdit" update=":formX:msg" listener="#{deklaracjevatView.edit}" />
            <p:column headerText="wersja" width="60">
                <h:outputText value="#{item.wzorschemy}"/>
            </p:column>
            <p:column headerText="dane">
                <p:dataGrid columns="1" value="#{item.selected}" var="loop">
                    <h:panelGrid columns="4" columnClasses="twofive-percent, twofive-percent, twofive-percent, twofive-percent">
                        <h:outputText value="rodzaj deklaracji"/><h:outputText value="#{loop.rodzajdeklaracji}" style="font-weight: 900;"/>
                        <h:outputText value="podatnik"/><h:outputText value="#{item.podatnik}" style="font-weight: 900;"/>
                        <h:outputText value="miesięczna/kwartalna"/><h:outputText value="#{item.miesiackwartal eq false ? 'miesięczna' : 'kwartalna'}" style="font-weight: 900;"/>
                        <h:outputText value="okres rozliczeniowy"/><h:outputText value="#{item.rok}#{item.rok != null ? '/' : null}#{item.miesiac}" style="font-weight: 900;"/>
                        <h:outputText value="pierw./kor."/><h:outputText value="#{loop.celzlozenia eq 1 ? 'pierwotna' : 'korekta'}" style="font-weight: 900;"/>
                        <h:outputText value="nazwa urzędu"/><h:outputText value="#{loop.nazwaurzedu}"/>
                    </h:panelGrid>
                    <p:dataTable value="#{item.schemawierszsumarycznylista}" var="wiersz" style="width: 700px;">
                        <p:column width="500" rendered="#{wiersz.deklaracjaVatWierszSumaryczny.sumavat ne 0}">
                            <h:outputText value="#{wiersz.deklaracjaVatWierszSumaryczny.nazwapozycji}"/>
                        </p:column>
                        <p:column width="50" rendered="#{wiersz.deklaracjaVatWierszSumaryczny.sumavat ne 0}">
                            <h:outputText value="#{wiersz.polevat}"/>
                        </p:column>
                        <p:column rendered="#{wiersz.deklaracjaVatWierszSumaryczny.sumavat ne 0}">
                            <bcf:outputpl0 value="#{wiersz.deklaracjaVatWierszSumaryczny.sumavat}"/>
                        </p:column>
                    </p:dataTable>
<!--                    <h:panelGrid columns="4" columnClasses="twofive-percent, twofive-percent, twofive-percent, twofive-percent" >
                        <h:outputText value="razem należny"/><h:outputText value="#{item.schemawierszsumarycznylista.get(0).deklaracjaVatWierszSumaryczny.sumavat}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="razem naliczony"/><h:outputText value="#{item.schemawierszsumarycznylista.get(4).deklaracjaVatWierszSumaryczny.sumavat}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="z przeniesienia"/><h:outputText value="#{item.schemawierszsumarycznylista.get(1).deklaracjaVatWierszSumaryczny.sumavat}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="kwota do zapłaty"/><h:outputText value="#{item.schemawierszsumarycznylista.get(5).deklaracjaVatWierszSumaryczny.sumavat}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="kwota do zwrotu"/><h:outputText value="#{item.schemawierszsumarycznylista.get(6).deklaracjaVatWierszSumaryczny.sumavat}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="na rachunek bankowy 25 dni"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI62}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="na rachunek bankowy 60 dni"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI63}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="na rachunek bankowy 180 dni"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI64}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="kwota autoryzacyjna"/><bcf:outputpl value="#{loop.kwotaautoryzacja}"/>
                        <h:outputText value="korekta ręczna" rendered="#{item.vatDeklaracjaKorektaDokWykaz != null}"/><h:outputText value="#{item.vatDeklaracjaKorektaDokWykaz}" style="float: right;">
                            </h:outputText>
                    </h:panelGrid>-->
                </p:dataGrid>
            </p:column>
            <p:column id="previewColumn" headerText="operacje" width="110" style="text-align: center;">
                <p:panelGrid columns="1">
                    <p:commandButton value="Pdf" actionListener="#{deklaracjevatView.drukujprzygotowanedowysylki(item)}" style="width: 80px;"/>
                    <p:commandButton id="mailbutton" value="Mail" actionListener="#{deklaracjevatView.mailvat7(-1) }" update=":formX" style="width: 80px; display: none;"  />
                    <p:commandButton id="mailbuttonN" value="Mail" actionListener="#{deklaracjevatView.mailvat7N(-1) }" update=":formX" style="width: 80px; display: none;"  />
                </p:panelGrid>
            </p:column>
            <p:column id="deleteColumn" headerText="usuń" width="110" style="text-align: center;">
                <p:commandButton actionListener="#{deklaracjevatView.destroy(item)}" onclick="PF('confirmation').show()" id="delete" icon="ui-icon ui-icon-trash" type="submit" style="width: 80px;"/>
            </p:column>
            <p:rowExpansion>
                <p:column id="ewidencjavat" headerText="treść wysyłki" width="300" resizable="true">
                    <p:inplace id="ajax" editor="true">
                        <p:inputTextarea autoResize="true" value="#{item.deklaracja}" cols="190"/>
                        <p:ajax event="save" listener="#{deklaracjevatView.handleSave}" />
                    </p:inplace>
                </p:column>
            </p:rowExpansion>
        </p:dataTable>
    </h:form><br/>
    <h:outputText value="Najpierw należy wypełnić VAT-ZT, a dopiero potem ORD-ZU!" style="color: red;" rendered="#{deklaracjevatView.pokazZZ}"/>
    <h:form id="zalacznikZT">
        <p:panel header="Załącznik VAT-ZT" rendered="#{deklaracjevatView.pokazZZ}"  style="max-width: 1400px;">
            <h:outputText value="Załącznik podpięty." rendered="#{deklaracjevatView.oczekujace.get(0).deklaracja.contains('Wniosek_VAT-ZT')}"/>
            <p:panelGrid columns="1"  rendered="#{!deklaracjevatView.oczekujace.get(0).deklaracja.contains('Wniosek_VAT-ZT')}">
                <h:outputText value="Przygotowana korekta deklaracji nie zawiera wniosku o przyspieszony termin zwrotu, nie może być wysłana!"/>
                <h:outputText value="wnioskowana kwota"/><h:inputText style="width: 200px;" value="#{vat7VATZTView.kwota}"/>
                <h:outputText value="powód wniosku"/>
<!--                <p:selectOneMenu value="#{vat7VATZTView.powod}" converter="DeklaracjaVatZZPowodConv" style="width: 700px;">
                        <f:selectItem itemLabel="wybierz powód" itemValue=""/>
                        <f:selectItems value="#{deklaracjaVatZZPowodPrzypView.powodysource}" var="item" itemLabel="#{item.tresc}" itemValue="#{item}"/>
                        <p:ajax event="change" listener="#{deklaracjaVatZZPowodPrzypView.pobierzprzyporzadkowanie}" partialSubmit="true" 
                                />
                </p:selectOneMenu>-->
                <h:outputText value="uzasadnienie wniosku"/><h:inputTextarea rows="5" style="width: 900px;" value="#{vat7VATZTView.informacja}"/>
                <p:commandButton value="Załącz" actionListener="#{vat7VATZTView.dodajzalacznikVATZT()}" update="@all"/>
            </p:panelGrid>
        </p:panel>
    </h:form>
    <h:form id="zalacznik">
        <p:panel header="Załącznik ORD-ZU" rendered="#{deklaracjevatView.oczekujace.size() eq 0 ? false : (deklaracjevatView.oczekujace.get(0).selected.celzlozenia eq 2 ? true : false)}"  
                 style="max-width: 1400px;">
            <h:outputText value="Załącznik podpięty." rendered="#{deklaracjevatView.oczekujace.get(0).deklaracja.contains('Zalacznik_ORD-ZU')}"/>
            <p:panelGrid columns="1"  rendered="#{!deklaracjevatView.oczekujace.get(0).deklaracja.contains('Zalacznik_ORD-ZU')}">
                <h:outputText value="Przygotowana korekta deklaracji nie zawiera wyjaśnienia przyczyny korekty, nie może być wysłana!"/>
                <h:inputTextarea rows="5" style="width: 900px;" value="#{vat7ORDZUView.trescwyjasnienia}"/>
                <p:commandButton value="Załącz" actionListener="#{vat7ORDZUView.dodajzalacznikORDZAU()}" update="@all"/>
            </p:panelGrid>
        </p:panel>
    </h:form>
    <p:accordionPanel id="akordeon" rendered="#{deklaracjevatView.oczekujace.size() gt 0}"  style="max-width: 1400px;"> 
        <p:tab title="W celu wysłania deklaracji na serwer ministerstwa wciśnij przycisk wyślij. Celem uzyskania potwierdzenia, należy odpowiednio kliknąć na przycisk upo">
        <p:panelGrid columns="2" style="width: 100%;">
            <p:column>
                <h:form>
                    <p:commandButton value="wyślij" actionListener="#{beanek.rob(deklaracjevatView.oczekujace)}" update=":akordeon:form" style="width: 150px;"/>
                    <p:commandButton value="upo" actionListener="#{beanek.pobierz()}" update=":akordeon:form" style="margin-left: 3%; width: 150px;"/>
                </h:form>
            </p:column>
            <p:column>
                <h:form id="form">
                    <p:panelGrid columns="2" id="upoform" style="width: 100%;">
                        <h:outputText value="id przesyłki" />
                        <h:inputText value="#{beanek.idpobierz}" style="width: 90%;"/>
                        <h:outputText value="UPO" />
                        <h:inputTextarea id="upo" value="#{beanek.upoMB}" readonly="true" style="width: 90%; height: 60px;"/>
                        <h:outputText value="status przesyłki - symbol"/>
                        <h:outputText id="stat" value="#{beanek.statMB}"  style="#{beanek.statMB eq '200' ? 'color: green; font-weight: 900;' : null}"/>
                        <h:outputText value="opis statusu przesyłki" />
                        <h:inputTextarea id="opis" value="#{beanek.opisMB}" readonly="true" style="width: 600px; height: 70px;"/>
                    </p:panelGrid>
                </h:form>
                </p:column>
            </p:panelGrid>
        </p:tab>
    <p:tab title="Można też przetestować wysyłke deklaracji. Celem uzyskania potwierdzenia, należy odpowiednio kliknąć na przycisk sprawdz">
        <p:panelGrid columns="2" style="width: 100%;">
            <p:column>
                <h:form>
                    <p:commandButton value="test" actionListener="#{beanek.robtest(deklaracjevatView.oczekujace)}" update=":akordeon:formtest" style="width: 150px;"/>
                    <p:commandButton value="sprawdź" actionListener="#{beanek.pobierztest()}" update=":akordeon:formtest" style="margin-left: 3%; width: 150px;"/>
                </h:form>
            </p:column>
            <p:column>
                <h:form id="formtest">
                    <p:panelGrid columns="2" id="upoformtest" style="width: 100%;">
                        <h:outputText value="id przesyłki"/>
                        <h:inputText value="#{beanek.idpobierzT}" style="width: 90%;"/>
                        <h:outputText value="UPO"/>
                        <h:inputTextarea id="upotest" value="#{beanek.upoMBT}" readonly="true" style="width: 90%; height: 60px;"/>
                        <h:outputText value="status przesyłki - symbol"/>
                        <h:outputText id="stattest" value="#{beanek.statMBT}" style="#{beanek.statMBT eq '200' ? 'color: green; font-weight: 900;' : null}"/>
                        <h:outputText value="opis statusu przesyłki"/>
                        <h:inputTextarea id="opistest" value="#{beanek.opisMBT}" readonly="true" style="width: 600px; height: 70px;"/>
                    </p:panelGrid>
                </h:form>
            </p:column>
            </p:panelGrid>
    </p:tab>
     <p:tab title="Deklaracja została wysłana poza programem. Kliknij ,żeby zachować jej wersje elektroniczną w programie.">
        <p:panelGrid columns="2" style="width: 80%;">
        <h:form>
            <p:commandButton value="oznacz" actionListener="#{beanek.wysylkaReczna(deklaracjevatView.oczekujace)}" update=":akordeon:formrecznie:upoformrecznie" style="width: 150px;"/>
        </h:form>
        <h:form id="formrecznie">
            <p:panelGrid columns="2" id="upoformrecznie" style="width: 100%;">
                <h:outputText value="id przesyłki"/>
                <h:inputText value="#{beanek.idpobierzT}" style="width: 90%;"/>
                <h:outputText value="UPO"/>
                <h:inputTextarea id="upotest" value="#{beanek.upoMBT}" readonly="true" style="width: 90%; height: 60px;"/>
                <h:outputText value="status przesyłki - symbol"/>
                <h:outputText id="stattest" value="#{beanek.statMBT}" style="#{beanek.statMBT eq '200' ? 'color: green; font-weight: 900;' : null}"/>
                <h:outputText value="opis statusu przesyłki"/>
                <h:inputTextarea id="opistest" value="#{beanek.opisMBT}" readonly="true" style="width: 90%; height: 60px;"/>
            </p:panelGrid>
        </h:form>
            </p:panelGrid>
    </p:tab>
        </p:accordionPanel>
    
</ui:composition>   


