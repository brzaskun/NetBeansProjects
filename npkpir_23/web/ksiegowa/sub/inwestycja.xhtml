<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ft="http://primefaces.prime.com.tr/facestrace"
    xmlns:pe="http://primefaces.org/ui/extensions">
    <p:tabView id="akordeon">
        <p:tab title="rozpoczęte">
          
            <p:panelGrid columns="4" style="margin-left: 65%;">
                <h:outputText value="m-c zakończenia"/><h:selectOneMenu value="#{inwestycjeView.mczakonczenia}">
                    <f:selectItems value="#{Mce.mceList}"/>
                </h:selectOneMenu>
                <h:outputText value="rok zakończenia"/><h:selectOneMenu value="#{inwestycjeView.rokzakonczenia}">
                    <f:selectItems value="#{Roki.rokiList}"/>
                </h:selectOneMenu>
            </p:panelGrid>
            <p:dataTable id="dataList" value="#{inwestycjeView.inwestycjerozpoczete}" style="width: 1600px;" emptyMessage="Nie ma żadnych rozpoczętych inwestycji w firmie" var="item"
                         paginatorTemplate="{FirstPageLink} {PageLinks} {LastPageLink} {RowsPerPageDropdown}" 
                         rowsPerPageTemplate="20,100,250,500" paginatorPosition="top" paginator="true"  selection="#{inwestycjeView.wybrany}" selectionMode="single"
                         rowKey="#{item.id}">
                <p:ajax event="rowSelect" listener="#{inwestycjeView.wybranoinwestycje}"/>
                <p:column width="10">
                    <p:rowToggler />
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Symbol"/>
                    </f:facet>
                    <h:outputText value="#{item.symbol}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Skrót"/>
                    </f:facet>
                    <h:outputText value="#{item.skrot}"/>
                </p:column>
                <p:column width="300">
                    <f:facet name="header">
                        <h:outputText value="Opis"/>
                    </f:facet>
                    <h:outputText value="#{item.opis}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Rozpoczęcie"/>
                    </f:facet>
                    <h:outputText value="#{item.rokrozpoczecia}/#{item.mcrozpoczecia}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Zakończenie"/>
                    </f:facet>
                    <h:outputText value="#{item.rokzakonczenia}#{item.rokzakonczenia != '' ? '/' :''}#{item.mczakonczenia}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Total"/>
                    </f:facet>
                    <h:outputText value="#{item.total eq 0 ? '' : item.total}" style="float: right;">
                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                    </h:outputText>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Suma za lata"/>
                    </f:facet>
                    <p:dataTable value="#{item.sumazalata}" var="loop" emptyMessage="Brak wpisów">
                        <p:column>
                            <h:outputText value="#{loop.rok}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{loop.kwota}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </p:column>
                <p:rowExpansion>
                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="Dokumenty"/>
                        </f:facet>
                        <p:dataTable value="#{item.dokumenty}" var="wpis" emptyMessage="Brak wpisów" 
                                     paginatorTemplate="{FirstPageLink} {PageLinks} {LastPageLink} {RowsPerPageDropdown}" 
                                     rowsPerPageTemplate="20,100,250,500" paginatorPosition="top" paginator="true" style="width: 1100px;">

                            <p:column id="nrColumn" headerText="lp" sortBy="NrWpkpir" width="50">  
                                <h:outputText value="#{wpis.nrWpkpir}"/>
                            </p:column>
                            <p:column id="dataColumn" headerText="data wyst" filterBy="dataWyst" filterMatchMode="contains" sortBy="dataWyst" width="110">  
                                <h:outputText value="#{wpis.dataWyst}"/>
                            </p:column>
                            <p:column id="kontrColumn" headerText="kontrahent" filterBy="kontr.npelna" filterMatchMode="contains" sortBy="kontr.npelna" width="250">  
                                <h:outputText value="#{wpis.kontr.npelna} #{wpis.kontr.miejscowosc}" />
                            </p:column>
                            <p:column id="rodzTrColumn" headerText="nip" filterBy="kontr.nip" filterMatchMode="contains" sortBy="kontr.nip" width="110">  
                                <h:outputText value="#{wpis.kontr.nip}"/>
                            </p:column>
                            <p:column id="nrWlDokColumn" headerText="nr wł" filterBy="nrWlDk" filterMatchMode="contains" sortBy="nrWlDk" width="110" >   
                                <h:outputText value="#{wpis.nrWlDk}"/>
                            </p:column>
                            <p:column id="nettoColumn" headerText="netto" filterBy="netto" filterMatchMode="contains" sortBy="netto" width="110">  
                                <h:outputText value="#{wpis.netto}" style="float: right;">
                                    <f:convertNumber minFractionDigits="2" locale="PL"/>
                                </h:outputText>
                            </p:column>
                              <p:column id="vatColumn" headerText="brutto" filterBy="brutto" filterMatchMode="contains" sortBy="brutto" width="110">  
                                <h:outputText value="#{wpis.brutto}" style="float: right;">
                                    <f:convertNumber minFractionDigits="2" locale="PL"/>
                                </h:outputText>
                            </p:column>
                        </p:dataTable>
                    </p:column>
                </p:rowExpansion>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Stan"/>
                    </f:facet>
                    <h:outputText value="#{item.zakonczona eq true ? 'zakończona' : 'rozpoczęta'}"/>
                </p:column>
                 <p:column style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                     <p:commandButton value="Drukuj" actionListener="#{pdfInwestycja.drukujinwestycje(item)}" icon="ui-icon-print" style="width: 90px;"/>
                </p:column>
                <p:column style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <p:commandButton value="Zakończ" actionListener="#{inwestycjeView.zamknijinwestycje(item)}" icon="ui-icon-locked" update=":form:akordeon:dataList :form:akordeon:zakonczoneList" style="width: 90px;"/>
                </p:column>
                <p:column style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <p:commandButton value="Usuń" actionListener="#{inwestycjeView.usun}" icon="ui-icon-trash" update=":form:akordeon:dataList" style="width: 90px;"/>
                </p:column>
                
            </p:dataTable>
            <p>
              <p:commandButton value="#{mgs.drukuj}" type="button" icon="ui-icon-print">  
                <p:printer target=":form:akordeon:dataList" />  
            </p:commandButton>
                </p>
        </p:tab>

        <p:tab id="nowa" title="nowa">
            <p:focus for="nowapanel">
                <p:panelGrid id="nowapanel" columns="2">
                    <h:outputLabel value="Rok rozpoczecia:" for="rokrozpoczecia" />
                    <p:selectOneMenu id="rokrozpoczecia" value="#{inwestycjeView.selected.rokrozpoczecia}" required="true" style="width: 70px;">
                        <f:selectItems value="#{Roki.rokiList}"/>
                    </p:selectOneMenu>
                    <h:outputLabel value="Mc rozpoczecia:" for="mcrozpoczecia" />
                    <p:selectOneMenu id="mcrozpoczecia" value="#{inwestycjeView.selected.mcrozpoczecia}" required="true"  style="width: 70px;">
                        <f:selectItems value="#{Mce.mceList}"/>
                    </p:selectOneMenu>
                    <h:outputLabel value="Skrót:" for="skrot" />
                    <p:inputText id="skrot" value="#{inwestycjeView.selected.skrot}" title="Skrot" />
                    <h:outputLabel value="Opis:" for="opis" />
                    <p:inputTextarea id="opis" value="#{inwestycjeView.selected.opis}" cols="40" title="Opis"/>
                </p:panelGrid>
            </p:focus>
            <p:commandButton value="Dodaj" actionListener="#{inwestycjeView.dodaj}" update="@form :form:akordeon:dataList"/>
        </p:tab>
        <p:tab title="zakończone">
            <p:contextMenu for="zakonczoneList">
            </p:contextMenu>
            <p:dataTable id="zakonczoneList" value="#{inwestycjeView.inwestycjezakonczone}" style="width: 1600px;" emptyMessage="Nie ma żadnych zakończonych inwestycji w firmie" var="item"
                         paginatorTemplate="{FirstPageLink} {PageLinks} {LastPageLink} {RowsPerPageDropdown}" 
                         rowsPerPageTemplate="20,100,250,500" paginatorPosition="top" paginator="true"  selection="#{inwestycjeView.wybrany}" selectionMode="single"
                         rowKey="#{item.id}">
                <p:ajax event="rowSelect" listener="#{inwestycjeView.wybranoinwestycje}"/>
                <p:column width="10">
                    <p:rowToggler />
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Symbol"/>
                    </f:facet>
                    <h:outputText value="#{item.symbol}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Skrót"/>
                    </f:facet>
                    <h:outputText value="#{item.skrot}"/>
                </p:column>
                <p:column width="300">
                    <f:facet name="header">
                        <h:outputText value="Opis"/>
                    </f:facet>
                    <h:outputText value="#{item.opis}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Rozpoczęcie"/>
                    </f:facet>
                    <h:outputText value="#{item.rokrozpoczecia}/#{item.mcrozpoczecia}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Zakończenie"/>
                    </f:facet>
                    <h:outputText value="#{item.rokzakonczenia}#{item.rokzakonczenia != '' ? '/' :''}#{item.mczakonczenia}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Total"/>
                    </f:facet>
                    <h:outputText value="#{item.total eq 0 ? '' : item.total}" style="float: right;">
                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                    </h:outputText>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Suma za lata"/>
                    </f:facet>
                    <p:dataTable value="#{item.sumazalata}" var="loop" emptyMessage="Brak wpisów">
                        <p:column>
                            <h:outputText value="#{loop.rok}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{loop.kwota}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </p:column>
                <p:rowExpansion>
                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="Dokumenty"/>
                        </f:facet>
                        <p:dataTable value="#{item.dokumenty}" var="wpis" emptyMessage="Brak wpisów" 
                                     paginatorTemplate="{FirstPageLink} {PageLinks} {LastPageLink} {RowsPerPageDropdown}" 
                                     rowsPerPageTemplate="20,100,250,500" paginatorPosition="top" paginator="true" style="width: 1100px;">

                            <p:column id="nrColumn" headerText="lp" sortBy="NrWpkpir" width="50">  
                                <h:outputText value="#{wpis.nrWpkpir}"/>
                            </p:column>
                            <p:column id="dataColumn" headerText="data wyst" filterBy="dataWyst" filterMatchMode="contains" sortBy="dataWyst" width="110">  
                                <h:outputText value="#{wpis.dataWyst}"/>
                            </p:column>
                            <p:column id="kontrColumn" headerText="kontrahent" filterBy="kontr.npelna" filterMatchMode="contains" sortBy="kontr.npelna" width="250">  
                                <h:outputText value="#{wpis.kontr.npelna} #{wpis.kontr.miejscowosc}" />
                            </p:column>
                            <p:column id="rodzTrColumn" headerText="nip" filterBy="kontr.nip" filterMatchMode="contains" sortBy="kontr.nip" width="110">  
                                <h:outputText value="#{wpis.kontr.nip}"/>
                            </p:column>
                            <p:column id="nrWlDokColumn" headerText="nr wł" filterBy="nrWlDk" filterMatchMode="contains" sortBy="nrWlDk" width="110" >   
                                <h:outputText value="#{wpis.nrWlDk}"/>
                            </p:column>
                            <p:column id="nettoColumn" headerText="netto" filterBy="netto" filterMatchMode="contains" sortBy="netto" width="110">  
                                <h:outputText value="#{wpis.netto}" style="float: right;">
                                    <f:convertNumber minFractionDigits="2" locale="PL"/>
                                </h:outputText>
                            </p:column>
                              <p:column id="vatColumn" headerText="brutto" filterBy="brutto" filterMatchMode="contains" sortBy="brutto" width="110">  
                                <h:outputText value="#{wpis.brutto}" style="float: right;">
                                    <f:convertNumber minFractionDigits="2" locale="PL"/>
                                </h:outputText>
                            </p:column>
                        </p:dataTable>
                    </p:column>
                </p:rowExpansion>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Stan"/>
                    </f:facet>
                    <h:outputText value="#{item.zakonczona eq true ? 'zakończona' : 'rozpoczęta'}"/>
                </p:column>
                 <p:column style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                     <p:commandButton value="Drukuj" actionListener="#{pdfInwestycja.drukujinwestycje(item)}" icon="ui-icon-print" style="width: 90px;"/>
                </p:column>
                 <p:column style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                     <p:commandButton value="Otwórz" actionListener="#{inwestycjeView.otworzinwestycje(item)}" icon="ui-icon-unlocked" update=":form:akordeon:dataList :form:akordeon:zakonczoneList" style="width: 90px;"/>
                </p:column>
            </p:dataTable>
        </p:tab>
    </p:tabView>
</ui:composition>   

