<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ft="http://primefaces.prime.com.tr/facestrace"
    xmlns:pe="http://primefaces.org/ui/extensions">
    <!--   Dialog wyskakujący po wybraniu opcji Edytuj dokument -->
    <!--   Dialog wyskakujący po wybraniu opcji Edytuj dokument -->
    <p:dialog id="dialogEdycja" header="Dane dokumentu:" widgetVar="dlg123" resizable="false" onShow="przeniesKwotaDoNetto();" dynamic="true" >
        <h:form id="dodWiad">
            <p:panel menuTitle="Wprowadzanie dokumentów klient" header="Edytowanie zaksięgowanego dokumentu klienta: #{WpisView.podatnikWpisu} okres: #{WpisView.rokWpisu}/#{WpisView.miesiacWpisu}" style="width: 1100px;" id="wprowadzanie">
                <p:growl id="mess_add" />
                <p:focus for="polawprowadzania"/>
                <p:panelGrid id="polawprowadzania" columns="6" >
                    <h:outputLabel value="data wystawienia" style="font-weight: 700"/>
                    <h:outputLabel value="kontrahent" style="font-weight: 700"/>
                    <h:outputLabel value="dok.prosty" style="font-weight: 700" />
                    <h:outputLabel value="rodzaj dok" style="font-weight: 700"/>
                    <h:outputLabel value="nr własny" style="font-weight: 700;"/>
                    <h:outputLabel value="opis transakcji (F9)/nowa kol (F8)" style="font-weight: 700"/>


                    <p:inputText id="dataPole" value="#{DokumentView.selDokument.dataWyst}"   accesskey="s" maxlength="10" style="width: 120px" size="10"  required="true" requiredMessage="Pole daty nie może byc puste" immediate="false"  onblur="ustawDate(#{WpisView.rokWpisu},#{WpisView.miesiacWpisu});" title="wpisz numer dania, lub miesiąc i dzień" >
                    </p:inputText>

                    <h:panelGroup id="dwadoWprowadzania" >
                        <p:autoComplete id="acForce" value="#{DokumentView.selDokument.kontr}" completeMethod="#{KlView.complete}"
                                        var="p" itemLabel="#{p.npelna}" itemValue="#{p}" converter="KlientConv" title="wpisz nazwę lub nip kontrahenta"
                                        minQueryLength="3" maxResults="10" maxlength="10" converterMessage="Nieudana konwersja Klient"
                                        valueChangeListener="#{DokumentView.przekazKontrahenta}"  autocomplete="true" forceSelection="true" global="false"
                                        required="true" requiredMessage="Pole klienta nie może byc puste" queryDelay="10" >
                            <f:ajax event="blur" execute="@this"/>
                            <f:facet name="itemtip">  
                                <h:panelGrid  columns="2" cellpadding="5" width="400">  
                                    <f:facet name="header">  
                                        <h:outputText value="Dane kontrahenta"/>
                                    </f:facet>  
                                    <h:outputText value="Nazwa: " />  
                                    <h:outputText id="npelna" value="#{p.npelna}" />  
                                    <h:outputText value="NIP: " />  
                                    <h:outputText id="nip" value="#{p.nip}" />  
                                    <h:outputText value="Adres " />  
                                    <h:outputText id="klumna" value="#{p.miejscowosc} #{p.ulica} #{p.dom} #{p.lokal}" /> 
                                </h:panelGrid>
                            </f:facet>
                            <f:param name="passedValue" value="#{p}" />
                        </p:autoComplete>
                    </h:panelGroup>
                    <h:selectBooleanCheckbox id="dokumentprosty" value="#{DokumentView.selDokument.dokumentProsty}">
                        <p:ajax event="click" listener="#{DokumentView.dokumentProstuSchowajEwidencje()}" global="false"/>
                    </h:selectBooleanCheckbox>
                    <h:selectOneMenu id="rodzajTrans" value="#{DokumentView.typdokumentu}"   style="width: 120px;" required="true" title="wybierz rodzaj księgowanego dokumentu">
                        <f:selectItems value="#{DokumentView.rodzajedokKlienta}" var="loop" itemLabel="#{loop.skrot}" itemValue="#{loop.skrot}"/>
                        <p:ajax event="blur" listener="#{DokumentView.wygenerujnumerkolejny()}" update=":dodWiad:numerwlasny" oncomplete="aktywujopis();"/>
                    </h:selectOneMenu> 
                    <p:inputText id="numerwlasny" value="#{DokumentView.selDokument.nrWlDk}" title="wpisz numer własny faktury">
                    </p:inputText>

                    <p:autoComplete id="opis" value="#{DokumentView.selDokument.opis}" completeMethod="#{Opis.complete}"
                                    var="p" itemLabel="#{p}" itemValue="#{p}"  title="wpisz opis faktury"
                                    minQueryLength="2" maxResults="10" maxlength="40"
                                    effect="clip" autocomplete="true"  required="true" requiredMessage="Brak opisu transakcji - uzupełnij" queryDelay="1" style="width: 200px;">
                        <p:ajax event="change" partialSubmit="true" global="false"/>
                    </p:autoComplete>

                </p:panelGrid>
                <p:commandButton id="dodajopis" value="ok" actionListener="#{Opis.dodajOpis}" style="display: none;"/>
                <!--        <span id="log"></span>-->
                <p:panelGrid columns="6">
                    <h:outputLabel value="dod.kol" style="font-weight: 700; display: none;"/>
                    <h:outputLabel value="kwota faktury netto - kolumna pkpir" style="font-weight: 700"/>
                    <h:outputLabel value="rozliczony" style="font-weight: 700"/>
                    <h:outputLabel value="termin płatności" style="font-weight: 700"/>
                    <h:outputLabel value="kwota brutto" style="font-weight: 700"/>
                    <h:outputLabel id="inwestycjas" value="inwestycja" style="font-weight: 700; display: none;"/>
                    <p:commandButton id="dodkol" value="F8" actionListener="#{DokumentView.liczbaw()}" update=":dodWiad:panel" oncomplete="aktywujnetto()" accesskey="p" style="display: none;"/>

                    <p:outputPanel id="panel">
                        <!-- kolumny podatkowej ksiegi przychodow i rozchodow-->
                        <ui:repeat id="repeat" value="#{DokumentView.nettokolumna}" var="row" varStatus="rowStat"  >
                            <pe:inputNumber id="kwotaPkpir" value="#{DokumentView.nettokolumna[rowStat.index].netto}" symbol=" zł" required="true" requiredMessage="Brak kwoty - uzupełnij" style="width: 120px" symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="wiersznetto"> 
                                <p:ajax event="focus" listener="#{DokumentView.podepnijListe()}"  update=":dodWiad:repeat:kolumnaPkpir" global="false"/>
                                <p:ajax event="blur" global="false" onstart="przeniesKwotaDoNetto();"/>
                                <script>
                                       function zrobF(kwota) {
                                           var strX = kwota.replace(",", ".");
                                           strX = strX.replace(/\s/g, "");
                                           return parseFloat(strX);
                                       }
                                       $(function() {
                                           $("#dodWiad\\:repeat\\:1\\:kwotaPkpir_input").on('keyup', function(e) {
                                               var roznica;
                                               if (e.which == 107) {
                                                   var odjema = zrobF($(this).val());
                                                   var odjemna = zrobF($("#dodWiad\\:repeat\\:0\\:kwotaPkpir_input").val());
                                                   roznica = odjemna - odjema;
                                                   $(this).val(Math.abs(roznica));
                                                   e.stopImmediatePropagation();
                                               }
                                           })

                                       })
                                </script>
                            </pe:inputNumber>
                            <h:selectOneMenu id="kolumnaPkpir" value="#{DokumentView.nettokolumna[rowStat.index].nazwakolumny}" style="min-width: 150px" onblur="updatesum();">
                                <f:selectItems value="#{DokumentView.kolumny}"/>
                            </h:selectOneMenu><br/>
                        </ui:repeat>
                    </p:outputPanel>

                    <h:selectBooleanCheckbox id="rozliczony" value="#{DokumentView.selDokument.rozliczony}" onchange="przekazdate()">
                        <!--                <p:ajax event="click" listener="{DokumentView.skopiujdoTerminuPlatnosci}" update=":dodWiad:dataTPole" global="false" />-->
                    </h:selectBooleanCheckbox>
                    <p:inputText id="dataTPole" value="#{DokumentView.selDokument.terminPlatnosci}" maxlength="10" style="width: 120px" required="true" requiredMessage="Brakuje terminu platnosci" title="wpisz pełny termin płatności">
                    </p:inputText>
                    <p:inputText id="sumbrutto"  readonly="true" onfocus="updatesum();"/>
                    <h:selectOneMenu id="inwestycja" value="#{DokumentView.selDokument.symbolinwestycji}" style="width: 120px; display: none;">
                        <f:selectItems value="#{inwestycjeView.inwestycjesymbole}"/>
                    </h:selectOneMenu>
                </p:panelGrid>
                <p:commandButton id="dodatkowaKolumna" action="#{DokumentView.wygenerujNowaKolumnePkpir()}" value="DodKolumna" update=":formM:messages" global="false" accesskey="g" style="display: none;" />  
                <!--            <h:selectBooleanCheckbox id="dodatkowakolumna" value="{DokumentView.selDokument.dodatkowaKolumna}">
                                <p:ajax event="click" listener="{DokumentView.wygenerujNowaKolumnePkpir}" global="false"/>
                            </h:selectBooleanCheckbox>-->
                <!--dodatkowa kolumna pkpir-->
                <p:panelGrid id="grid2" columns="2" binding="#{DokumentView.grid2}">
                </p:panelGrid>
                <p:panel id="panelewidencji" style="width: 300px;">
                    <p:dataTable  var="wpis" value="#{STRTableView.obiektDOKjsfSel}" id="srodkiLista" editable="true" rendered="#{DokumentView.pokazEST}"
                                  paginator="true" paginatorAlwaysVisible="true" rows="6"
                                  paginatorTemplate="{FirstPageLink} {PageLinks} {LastPageLink} {RowsPerPageDropdown}" 
                                  rowsPerPageTemplate="6,12,18,24,32,50" style="width: 1500px; "
                                  rowKey="#{wpis.id}" selection="#{sTRSprzedazView.wybranesrodkitrwale}"> 

                        <f:facet name="header">  
                            <h:outputText value="Ewidencja srodkow trwalych" />  
                        </f:facet>
                        <p:column selectionMode="multiple"/>
                        <p:column id="idColumn" headerText="nr kolejny" width="40">  

                            <h:outputText value="#{wpis.nrsrodka}" style="#{wpis.styl}"/>
                        </p:column>

                        <p:column id="dataColumn" headerText="data zak" filterBy="#{wpis.datazak}" filterMatchMode="contains" sortBy="#{wpis.datazak}" width="80">  

                            <h:outputText value="#{wpis.datazak}" style="#{wpis.styl}">
                                <f:convertDateTime dateStyle="medium"  />
                            </h:outputText>
                        </p:column>
                        <p:column id="data2Column" headerText="data przek" filterBy="#{wpis.dataprzek}" filterMatchMode="contains" sortBy="#{wpis.dataprzek}" width="80">  

                            <h:outputText value="#{wpis.dataprzek}" style="#{wpis.styl}">
                                <f:convertDateTime dateStyle="medium"  />
                            </h:outputText>
                        </p:column>
                        <p:column id="nazwaColumn" headerText="nazwa" filterBy="#{wpis.nazwa}" filterMatchMode="contains" sortBy="#{wpis.nazwa}" >  

                            <h:outputText value="#{wpis.nazwa}"  style="#{wpis.styl}" />
                        </p:column>
                        <p:column id="kstColumn" headerText="KŚT" filterBy="#{wpis.kst}" filterMatchMode="contains" sortBy="#{wpis.kst}" width="50">  

                            <h:outputText value="#{wpis.kst}"  style="#{wpis.styl}" />
                        </p:column>
                        <p:column id="dowColumn" headerText="nr.fakt" filterBy="#{wpis.nrwldokzak}" filterMatchMode="contains" sortBy="#{wpis.nrwldokzak}" width="50">  

                            <h:outputText value="#{wpis.nrwldokzak}" style="#{wpis.styl}"  />
                        </p:column>
                        <p:column id="rodzTrColumn" headerText="kwota" filterBy="#{wpis.netto}" filterMatchMode="contains" sortBy="#{wpis.netto}">  

                            <h:outputText value="#{wpis.netto}" style="float: right; #{wpis.styl}">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                            </h:outputText>
                        </p:column>
                        <p:column id="vatColumn" headerText="umorz.pocz" filterBy="#{wpis.umorzeniepoczatkowe}" filterMatchMode="contains" sortBy="#{wpis.umorzeniepoczatkowe}">  

                            <h:outputText value="#{wpis.umorzeniepoczatkowe}" style="float: right; #{wpis.styl}">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                            </h:outputText>
                        </p:column>
                        <p:column id="stawkaColumn" headerText="odpis stawka" filterBy="#{wpis.stawka}" filterMatchMode="contains" sortBy="#{wpis.stawka}" width="50">  

                            <h:outputText value="#{wpis.stawka}%" style="#{wpis.styl}">
                                <f:convertNumber maxFractionDigits="2"
                                                 groupingUsed="true"
                                                 maxIntegerDigits="5"
                                                 type="number"/>
                            </h:outputText>
                        </p:column>
                        <p:column id="odpisrokColumn" headerText="odpis rok" filterBy="#{wpis.odpisrok}" filterMatchMode="contains" sortBy="#{wpis.odpisrok}" width="90">  

                            <h:outputText value="#{wpis.odpisrok}" style="float: right; #{wpis.styl}">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                            </h:outputText>
                        </p:column>
                        <p:column id="odpismcColumn" headerText="wyksiegowany" filterBy="#{wpis.odpismc}" filterMatchMode="contains" sortBy="#{wpis.odpismc}" width="90">  

                            <h:outputText value="#{wpis.datasprzedazy}" style="float: right; #{wpis.styl}">
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                    <p:separator/>

                </p:panel>
                <!--pola ewidencji SRODKOW TRWALYCH-->
                <p:panel id="panelwyszukiwarki" style="width: 300px;" >
                    <p:panel header="wyszukiwarka środka trw." style="width: 300px;" rendered="#{DokumentView.renderujwysz}"/>
                    <p:autoComplete id="acForce1" value="#{DokumentView.srodekkategoria}" completeMethod="#{srodkikstView.complete}"
                                    var="pa" itemLabel="#{pa.nazwa}" itemValue="#{pa}"  converter="SrodkiConv"
                                    minQueryLength="3" maxResults="15" maxlength="15" itemtipMyPosition="rightbottom"
                                    queryDelay="100" size="50" valueChangeListener="#{DokumentView.skopiujSTR()}" rendered="#{DokumentView.renderujwysz}">
                        <p:ajax event="blur" async="true" oncomplete="dataprzyjecia();"/>
                        <f:facet name="itemtip">  
                            <h:panelGrid  columns="2" cellpadding="5" width="400" >  
                                <f:facet name="header">  
                                    <h:outputText value="Dane środka trwałego"/>
                                </f:facet>  
                                <h:outputText value="Nazwa: " />  
                                <h:outputText id="npelna1" value="#{pa.nazwa}"/>  
                                <h:outputText value="Stawka " />  
                                <h:outputText id="nip1" value="#{pa.stawka}" />  
                                <h:outputText value="KŚT " />  
                                <h:outputText id="klumna1" value="#{pa.symbol}" /> 
                            </h:panelGrid>
                        </f:facet>
                    </p:autoComplete>
                </p:panel>
                <p:panel>
                    <p:panelGrid id="grid3" columns="8" binding="#{DokumentView.grid3}">
                    </p:panelGrid>
                </p:panel>

                <!--pola ewidencji VAT-->
                <p:panel>
                    <p:panelGrid id="grid1" columns="#{DokumentView.wielkoscopisuewidencji}" binding="#{DokumentView.grid1}">
                    </p:panelGrid>
                </p:panel>
                <!--pola ewidencji VAT-->
                <p:panelGrid columns="5">
                    <h:outputLabel value="data sprzedaży" style="font-weight: 700"/>
                    <h:outputLabel value="v m-c" style="font-weight: 700"/>
                    <h:outputLabel value="v rok" style="font-weight: 700"/>
                    <h:outputLabel value="uwagi" style="font-weight: 700"/>
                    <h:outputLabel value=""/>

                    <h:inputText id="dataSPole" value="#{DokumentView.selDokument.dataSprz}" maxlength="10" style="width: 120px" required="true" requiredMessage="Pole daty sprzedaży nie może byc puste" />
                    <h:selectOneMenu id="vatm" value="#{DokumentView.selDokument.vatM}">
                        <f:selectItems id="vatr" value="#{DokumentView.listamiesiecyewidencjavat}"/>
                    </h:selectOneMenu>
                    <h:selectOneMenu value="#{DokumentView.selDokument.vatR}">
                        <f:selectItems value="#{Roki.rokiList}"/>
                    </h:selectOneMenu>
                    <h:inputText value="#{DokumentView.selDokument.uwagi}" />
                    <h:commandButton id="wprowadzenieNowego" accesskey="w" actionListener="#{DokumentView.dodaj(2)}" value="Edytuj"  style="width: 150px;" > 
                    </h:commandButton>
                </p:panelGrid>
            </p:panel>
        </h:form>

    </p:dialog>
 
</ui:composition>   

