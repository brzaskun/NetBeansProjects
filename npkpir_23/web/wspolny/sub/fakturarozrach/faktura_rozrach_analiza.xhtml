<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ft="http://primefaces.prime.com.tr/facestrace"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:bcf="http://brzaskun.com/facelets">

    <p:tab id="nowa2" title="Analiza" >
        <style>
            .ui-autocomplete-input {
                width: 340px;
            }
        </style>
        <h:form id="fakturaanaliza">
            <p:panelGrid columns="3">
                <h:selectOneListbox id="wyborklienta" value="#{fakturaRozrachunkiAnalizaView.szukanyklient}" required="true" style="width: 300px;"  size="10" converter="KlientConv"
                                    styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all" binding="#{fakturaRozrachunkiAnalizaView.selectOneUI}"
                                    onfocus="$(this).removeClass('ui-state-default');
                                                    $(this).addClass('ui-state-focus');"
                                    onblur="$(this).removeClass('ui-state-focus');
                                                    $(this).addClass('ui-state-default');">
                    <f:selectItems value="#{fakturaRozrachunkiAnalizaView.klienci}"/>
                    <p:ajax event="change" global="false" listener="#{fakturaRozrachunkiAnalizaView.pobierzwszystko(WpisView.miesiacWpisu)}" update="fakturaanaliza:tablicaanaliza akordeon:analizaarchiwum"/>
                </h:selectOneListbox>
                <p:commandButton icon="fa fa-print" actionListener="#{fakturaRozrachunkiAnalizaView.drukujKlienci()}" global="false" style="width: 120px;"/>
                <p:commandButton icon="fa fa-paper-plane" actionListener="#{fakturaRozrachunkiAnalizaView.mailKlienci()}" style="width: 120px; margin-left: 15px;"/>
            </p:panelGrid>
            <style>
                th {
                    height: 25px;
                }
            </style>

            <p:dataTable id="tablicaanaliza" value="#{fakturaRozrachunkiAnalizaView.nowepozycje}" var="item" style="width: 940px; margin-top: 20px;"
                         emptyMessage="niczego nie zaksięgowano dla firmy #{fakturaRozrachunkiAnalizaView.szukanyklient}" selection="#{fakturaRozrachunkiAnalizaView.selectedrozliczenia}" rowKey="#{item.lp}"
                         >
                <f:facet name="header">
                    <h:outputText value="nowe dokumenty"/>
                </f:facet>
                <p:column selectionMode="multiple" width="30"/>
                <p:column width="20">
                    <f:facet name="header">
                        <h:outputText value="lp"/>
                    </f:facet>
                    <h:outputText value="#{item.lp}"/>
                </p:column>
                <p:column width="70" sortable="true" sortBy="#{item.data}">
                    <f:facet name="header">
                        <h:outputText value="data dok"/>
                    </f:facet>
                    <h:outputText value="#{item.data}"/>
                </p:column>
                <p:column width="100">
                    <f:facet name="header">
                        <h:outputText value="mail"/>
                    </f:facet>
                    <h:outputText value="#{item.mail}" rendered="#{item.mail ne ''}"/>
                </p:column>
                <p:column width="120">
                    <f:facet name="header">
                        <h:outputText value="dokument"/>
                    </f:facet>
                     <h:outputText value="#{item.rodzajDok} #{item.nrDok}"/>
                </p:column>
                <p:column width="90">
                    <f:facet name="header">
                        <h:outputText value="zapłata"/>
                    </f:facet>
                    <bcf:outputpl value="#{item.kwota}" rendered="#{item.faktura0rozliczenie1 eq true}"/>
                </p:column>
                <p:column width="90">
                    <f:facet name="header">
                        <h:outputText value="faktura"/>
                    </f:facet>
                    <bcf:outputpl value="#{item.kwota}" rendered="#{item.faktura0rozliczenie1 eq false}"/>
                </p:column>
                <p:column width="90">
                    <f:facet name="header">
                        <h:outputText value="saldo"/>
                    </f:facet>
                    <bcf:outputpl value="#{item.saldo}"/>
                </p:column>
                <p:column width="40" style="text-align: center;">
                    <p:commandButton icon="fa fa-archive" actionListener="#{fakturaRozrachunkiAnalizaView.rozlicz(item, true)}" update="akordeon:fakturaanaliza akordeon:analizaarchiwum"/>
                </p:column>
            </p:dataTable>
        </h:form>
        <h:form id="analizaarchiwum">
            <p:dataTable id="tablicaanaliza" value="#{fakturaRozrachunkiAnalizaView.archiwum}" var="item" style="width: 940px; margin-top: 20px;"
                         emptyMessage="niczego nie zarchiwizowane dla firmy #{fakturaRozrachunkiAnalizaView.szukanyklient}" selection="#{fakturaRozrachunkiAnalizaView.selectedrozliczenia}" rowKey="#{item.lp}"
                         >
                <f:facet name="header">
                    <h:outputText value="archiwum"/>
                </f:facet>
                <p:column selectionMode="multiple" width="30"/>
                <p:column width="20">
                    <f:facet name="header">
                        <h:outputText value="lp"/>
                    </f:facet>
                    <h:outputText value="#{item.lp}"/>
                </p:column>
                 <p:column width="100">
                    <f:facet name="header">
                        <h:outputText value="wprowadzil"/>
                    </f:facet>
                    <h:outputText value="#{item.wprowadzil}"/>
                </p:column>
                <p:column width="70">
                    <f:facet name="header">
                        <h:outputText value="data"/>
                    </f:facet>
                    <h:outputText value="#{item.data}"/>
                </p:column>
                <p:column width="120">
                    <f:facet name="header">
                        <h:outputText value="dokument"/>
                    </f:facet>
                     <h:outputText value="#{item.rodzajDok} #{item.nrDok}"/>
                </p:column>
                <p:column width="90">
                    <f:facet name="header">
                        <h:outputText value="zapłata"/>
                    </f:facet>
                    <bcf:outputpl value="#{item.kwota}" rendered="#{item.faktura0rozliczenie1 eq true}"/>
                </p:column>
                <p:column width="90">
                    <f:facet name="header">
                        <h:outputText value="faktura"/>
                    </f:facet>
                    <bcf:outputpl value="#{item.kwota}" rendered="#{item.faktura0rozliczenie1 eq false}"/>
                </p:column>
                <p:column width="90">
                    <f:facet name="header">
                        <h:outputText value="saldo"/>
                    </f:facet>
                    <bcf:outputpl value="#{item.saldo}"/>
                </p:column>
                <p:column width="40" style="text-align: center;">
                    <p:commandButton icon="fa fa-archive" actionListener="#{fakturaRozrachunkiAnalizaView.rozlicz(item, false)}" update="akordeon:fakturaanaliza akordeon:analizaarchiwum"/>
                </p:column>
            </p:dataTable>
        </h:form>
    </p:tab>  
</ui:composition> 
