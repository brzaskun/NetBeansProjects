<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ft="http://primefaces.prime.com.tr/facestrace"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:bcf="http://brzaskun.com/facelets">

    <p:tab id="nowa2" title="Analiza" >
        <style>
            .ui-autocomplete-input {
                width: 340px;
            }
        </style>
        <h:form id="fakturaanaliza">
            <p:autoComplete value="#{fakturaRozrachunkiAnalizaView.selected.kontrahent}" completeMethod="#{fakturaRozrachunkiAnalizaView.completeKL}"
                            var="p" itemLabel="#{p.npelna}" itemValue="#{p}" converter="KlientConv" title="wpisz nazwę lub nip kontrahenta"
                            maxResults="20" maxlength="20" converterMessage="Nieudana konwersja Klient" 
                            cache="true" forceSelection="true" queryDelay="10" 
                            required="true" requiredMessage="Pole klienta nie może być puste" styleClass="wpisywaniekontrfk" style="width: 350px;"
                            >
                <p:ajax event="query" global="false"/>
                <p:ajax event="itemSelect" partialSubmit="true" global="false"/>
                <f:facet name="itemtip">  
                    <h:panelGrid  columns="2" cellpadding="5" width="400">  
                        <f:facet name="header">  
                            <h:outputText value="Dane kontrahenta"/>
                        </f:facet>  
                        <h:outputText value="Nazwa: " />  
                        <h:outputText  value="#{p.npelna}" />  
                        <h:outputText value="NIP: " />  
                        <h:outputText value="#{p.nip}" />  
                        <h:outputText value="Adres " />  
                        <h:outputText value="#{p.miejscowosc} #{p.ulica} #{p.dom} #{p.lokal}" /> 
                    </h:panelGrid>
                </f:facet>
            </p:autoComplete>
            <p:commandButton value="pobierz" style="width: 120px;" actionListener="#{fakturaRozrachunkiAnalizaView.pobierzplatnosci(WpisView.miesiacWpisu)}" update="fakturaanaliza" global="false"/>
                <p:dataTable value="#{fakturaRozrachunkiRozlView.wprowadzoneplatnosci}" var="item" style="width: 1100px; margin-top: 20px;"
                             emptyMessage="niczego nie zaksięgowano w miesiącu #{WpisView.miesiacWpisu}">
                    <p:column width="30">
                        <f:facet name="header">
                            <h:outputText value="lp"/>
                        </f:facet>
                        <h:outputText value="#{item.lp}"/>
                    </p:column>
                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="wystawca"/>
                        </f:facet>
                        <h:outputText value="#{item.wystawca.nazwapelna}"/>
                    </p:column>
                    <p:column width="280">
                        <f:facet name="header">
                            <h:outputText value="kontrahent"/>
                        </f:facet>
                        <h:outputText value="#{item.kontrahent}"/>
                    </p:column>
                    <p:column width="100">
                        <f:facet name="header">
                            <h:outputText value="wprowadzil"/>
                        </f:facet>
                        <h:outputText value="#{item.wprowadzil.login}"/>
                    </p:column>
                    <p:column width="70">
                        <f:facet name="header">
                            <h:outputText value="data"/>
                        </f:facet>
                        <h:outputText value="#{item.data}"/>
                    </p:column>
                    <p:column width="90">
                        <f:facet name="header">
                            <h:outputText value="zapłata"/>
                        </f:facet>
                        <bcf:outputpl value="#{item.kwota}" rendered="#{!item.zaplata0korekta1}"/>
                    </p:column>
                    <p:column width="90">
                        <f:facet name="header">
                            <h:outputText value="korekta"/>
                        </f:facet>
                        <bcf:outputpl value="#{item.kwota}" rendered="#{item.zaplata0korekta1}"/>
                    </p:column>
                     <p:column width="70">
                        <f:facet name="header">
                            <h:outputText value="księgowano"/>
                        </f:facet>
                         <h:outputText value="#{item.dataksiegowania}">
                             <f:convertDateTime dateStyle="default" locale="pl"/>
                         </h:outputText>
                    </p:column>
                    <p:column width="40" style="text-align: center;">
                        <p:commandButton icon="ui-icon-trash" actionListener="#{fakturaRozrachunkiAnalizaView.usun(item)}" update="akordeon:fakturaanaliza"/>
                    </p:column>
                    
                </p:dataTable>
        </h:form>
    </p:tab>  
</ui:composition> 
