<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    
    >
<!--    <f:event type="preRenderView" listener="#{kontoSortView.init()}"/>-->
    <p:layout fullPage="false" style="width: 1450px; height: 700px;">  
        <p:layoutUnit position="north" >
            <p:panelGrid columns="2" columnClasses="kontaGrid1, kontaGrid2">
                <h:form id="formwpiskonta">
                    <h:outputText value="#{mgs.wybierzkonto}: "/>
                    <p:autoComplete id="wyborkonta" value="#{rozrachunkiPrzegladView.wybranekonto}" completeMethod="#{rozrachunkiPrzegladView.complete}"
                                    var="p" itemLabel="#{p.pelnynumer} #{p.nazwapelna}" itemValue="#{p}" cache="true" 
                                    minQueryLength="1" maxResults="15" maxlength="10" converter="#{kontoConv}" queryDelay="10" 
                                    converterMessage="Nieudana konwersja Klient"
                                    styleClass="kontoinput, autoCompleteBig" rendered="#{facesContext.viewRoot.locale.language.equals('pl')}"
                                    >
                        <p:ajax event="query" global="false"/>
                        <p:ajax event="itemSelect" global="false"
                                oncomplete="zaznacznoda('form:dataList_data','form:dataList','formwpiskonta:wyborkonta_input');" />
                    </p:autoComplete>
                    <p:autoComplete id="wyborkonta1" value="#{rozrachunkiPrzegladView.wybranekonto}" completeMethod="#{rozrachunkiPrzegladView.complete}"
                                    var="p" itemLabel="#{p.pelnynumer} #{p.de}" itemValue="#{p}" cache="true" 
                                    minQueryLength="1" maxResults="15" maxlength="10" converter="#{kontoConv}" queryDelay="10" 
                                    converterMessage="Nieudana konwersja Klient"
                                    styleClass="kontoinput, autoCompleteBig"  rendered="#{facesContext.viewRoot.locale.language.equals('de')}"
                                    >
                        <p:ajax event="query" global="false"/>
                        <p:ajax event="itemSelect" global="false" 
                                oncomplete="zaznacznoda('form:dataList_data','form:dataList','formwpiskonta:wyborkonta1_input');" />
                    </p:autoComplete>
                    <h:outputText value=" #{mgs.wybranekonto}:"/>
                    <p:panelGrid id="nazwawybranegokonta">
                        <h:outputText value=" #{rozrachunkiPrzegladView.wybranekonto.nazwapelna}" rendered="#{facesContext.viewRoot.locale.language.equals('pl')}"/>
                        <h:outputText value=" #{rozrachunkiPrzegladView.wybranekonto.de}" rendered="#{facesContext.viewRoot.locale.language.equals('de')}"/>
                    </p:panelGrid>
                </h:form>
                <h:form id="walutazapisynakoncie">
                    <h:outputText value="#{mgs.walutadokumentu} " style="text-align: right;"/>
                    <h:selectOneMenu id="wybranawaluta" value="#{rozrachunkiPrzegladView.wybranaWalutaDlaKont}">
                        <p:ajax event="change" listener="#{rozrachunkiPrzegladView.pobierzZapisyZmianaWaluty}" update=":tabelanowerozrachunki:tabela" />
                        <f:selectItem itemValue="wszystkie" itemLabel="#{mgs.wszystkie}"/>
                        <f:selectItems value="#{walutyViewSimple.symboleWalut}"/>
                    </h:selectOneMenu>
                    <p:commandButton value="#{mgs.drukuj}" actionListener="#{rozrachunkiPrzegladView.drukuj()}" style="margin-right: 50xp; float: left;"/>
                </h:form>
            </p:panelGrid>
            <h:outputText value="#{kontoZapisFKView.zapisydopodswietlenia}" id="zapisydopodswietlenia"  />
        </p:layoutUnit>  
        <!--            lewa strona z drzewem kont-->
        <p:layoutUnit id="westtree" position="west" size="350" >

            <h:outputScript library="js_fk" name="chodzeniepokontach.js"/>
            <h:form id="form1">

                    
                    <p:outputPanel id="kontenertabeli">
                        <style>
                                .grid .ui-widget-content .ui-datatable-odd td{
                                    height : 30px !important;
                                    padding: 0px 0px  !important;
                                }
                                .grid .ui-widget-content .ui-datatable-even td{
                                    height : 30px !important;
                                    padding: 0px 0px  !important;
                                }
                                .grid1 .ui-widget-content .ui-datatable-odd td{
                                    height : 30px !important;
                                    padding: 0px 0px  !important;
                                }
                                .grid1 .ui-widget-content .ui-datatable-even td{
                                    height : 30px !important;
                                    padding: 0px 0px  !important;
                                }
                          </style>
                          <p:dataTable id="dataList" value="#{rozrachunkiPrzegladView.wykazkont}" var="loop1" selectionMode="single" 
                                     selection="#{rozrachunkiPrzegladView.wybranekonto}" rowKey="#{loop1.id}" rowStyleClass="zapisyrowclass"
                                     styleClass="grid" style="width: 100%; height: 520px; overflow-y: scroll;" rowIndexVar="index"
                                     sortFunction="#{kontoSortView.sortujKonto}" sortBy="#{loop1}" >
                            <p:ajax event="rowSelect"  update=":tabelanowerozrachunki:tabela, :sumy, :formwpisrozrachunki:nazwawybranegokonta, :tabelazzapisami:tabela, :tabelazsumami:sumy, sumy"
                                    listener="#{rozrachunkiPrzegladView.pobierzZapisyNaKoncieNode(rozrachunkiPrzegladView.wybranekonto)}" 
                                    >
                            </p:ajax>
                            <p:ajax event="rowUnselect" global="false" update=":tabelanowerozrachunki:tabela, :sumy, :formwpisrozrachunki:nazwawybranegokonta, :tabelazzapisami:tabela, :tabelazsumami:sumy, sumy" 
                                    listener="#{rozrachunkiPrzegladView.pobierzZapisyNaKoncieNodeUnselect}" />
                            <p:column width="0.1">
                                <h:outputText value="#{index+1}" styleClass="lpwiersza" style="font-size: 0.1pt;"/>
                            </p:column>
                            <p:column  style="width: 50px; text-align: center;" width="10">
                                <h:outputText value="#{loop1.mapotomkow == true ? '+' : null}" /> 
                            </p:column>
                            <p:column headerText="nr konta" styleClass="#{loop1.level eq 2 ? 'druga' : null}" style="width: 100px; height: 30px;">
                                <h:outputText value="#{loop1.nrkonta}" rendered="#{loop1.nrkonta eq '0' ? false : (loop1.level eq '0' ? true : false)}" style="font-weight: 900;"/> 
                                <h:outputText value="#{loop1.pelnynumer}" rendered="#{loop1.nrkonta eq '0' ? false : (loop1.level eq '1' ? true : false)}" style="margin-left: 10px;"/> 
                                <h:outputText value="#{loop1.pelnynumer}" rendered="#{loop1.nrkonta eq '0' ? false : (loop1.level eq '2' ? true : false)}" style="margin-left: 20px;"/> 
                                <h:outputText value="#{loop1.pelnynumer}" rendered="#{loop1.nrkonta eq '0' ? false : (loop1.level eq '3' ? true : false)}" style="margin-left: 30px;"/> 
                            </p:column>
                            <p:column headerText="nazwa pełna" >
                                <h:outputText value="#{loop1.nazwapelna}" rendered="#{facesContext.viewRoot.locale.language.equals('pl')}"/>
                                <h:outputText value="#{loop1.de}" rendered="#{facesContext.viewRoot.locale.language.equals('de')}"/>
                            </p:column>
                        </p:dataTable>
<!--                        <p:treeTable id="dataList" value="#{rozrachunkiPrzegladView.root}" var="loop1" selectionMode="single" 
                                     selection="#{rozrachunkiPrzegladView.wybranekontoNode}" 
                                     styleClass="grid" style="width: 100%; height: 530px; overflow-y: scroll;" >
                            <p:ajax event="select" update=":tabelanowerozrachunki:tabela, :sumy, :formwpisrozrachunki:nazwawybranegokonta, :tabelazzapisami:tabela, :tabelazsumami:sumy, sumy" 
                                    listener="#{rozrachunkiPrzegladView.pobierzZapisyNaKoncieNode}" />
                            <p:ajax event="unselect" update=":tabelanowerozrachunki:tabela, :sumy, :formwpisrozrachunki:nazwawybranegokonta, :tabelazzapisami:tabela, :tabelazsumami:sumy, sumy" 
                                    listener="#{rozrachunkiPrzegladView.pobierzZapisyNaKoncieNodeUnselect}" />
                            <p:column headerText="nr konta" style="width: 120px; height: 30px;" styleClass="#{loop1.level eq 2 ? 'druga' : null}" >
                                <h:outputText value="#{loop1.pelnynumer}"/> 
                            </p:column>
                            <p:column headerText="nazwa pełna" >
                                <h:outputText value="#{loop1.nazwapelna}" rendered="#{facesContext.viewRoot.locale.language.equals('pl')}"/>
                                <h:outputText value="#{loop1.de}" rendered="#{facesContext.viewRoot.locale.language.equals('de')}"/>
                            </p:column>
                        </p:treeTable>-->
                    </p:outputPanel>
                </h:form>
        </p:layoutUnit>  

        <p:layoutUnit position="center" style="width: 1050px;">
            <h:form id="tabelanowerozrachunki">
                <p:dataTable id="tabela" value="#{rozrachunkiPrzegladView.stronyWiersza}" var="loop" rowKey="#{loop.id}" 
                             emptyMessage="#{mgs.Niemarozrachunkównakoncie}" sortBy="#{loop.id}"
                             rowIndexVar="rowindex" styleClass="grid1" style="width: 1200px;" expandedRow="true"
                             >
                    <p:column selectionMode="multiple" width="35" style="text-align: center;"></p:column>
                    <p:column style="height: 19px; text-align: center;" width="20">
                        <p:rowToggler />
                    </p:column>
                    <p:column headerText="#{mgs.numerkolejny}" width="40" style="text-align: center;" sortBy="#{loop.rowindex}" >
                        <h:outputText styleClass="lpwiersza" value="#{rowindex+1}"/>
                    </p:column>
                    <p:column headerText="#{mgs.waluta}" sortBy="#{loop.nazwaWaluty}" width="40">
                        <h:outputText value="#{loop.nazwaWaluty}"/>
                    </p:column>
                    <p:column headerText="#{mgs.kurs}" sortBy="#{loop.kursWalutyBOSW}" width="40">
                        <h:outputText value="#{loop.kursWalutyBOSW ne 0.0 ? loop.kursWalutyBOSW: ''}" rendered="#{loop.kursWalutyBOSW ne 'PLN'}"/>
                    </p:column>
                    <p:column headerText="#{mgs.data}" width="60" style="text-align: center;" sortBy="#{loop.wiersz.dataksiegowania}">
                        <h:outputText value="#{loop.wiersz.dataksiegowania.substring(0,10)}"/>
                    </p:column>
                    <p:column headerText="#{mgs.dokument}." width="60" >
                        <h:outputText value="#{loop.wiersz.dokfk.seriadokfk}/#{loop.wiersz.dokfk.nrkolejnywserii}"/>
                    </p:column>
                    <p:column headerText="#{mgs.numerwlasny}" sortBy="#{loop.wiersz.dokfk.numerwlasnydokfk}" width="110">
                        <h:outputText value="#{loop.wiersz.dokfk.numerwlasnydokfk}"/>
                    </p:column>
                    <p:column headerText="#{mgs.opis}" width="150" sortBy="#{loop.wiersz.dokfk.opisdokfk}">
                        <h:outputText value="#{loop.wiersz.opisWiersza}/#{loop.wiersz.dokfk.opisdokfk}"/>
                    </p:column>
                    <p:column headerText="#{mgs.kwota}" width="70">
                        <h:outputText value="#{loop.kwota}" style="float: right;">
                            <f:convertNumber minFractionDigits="2" locale="PL"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{mgs.rozliczono}" width="70">
                        <h:outputText value="#{loop.rozliczono}" style="float: right;">
                            <f:convertNumber minFractionDigits="2" locale="PL"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{mgs.pozostało}" width="70">
                        <h:outputText value="#{loop.pozostalo}" style="float: right;">
                            <f:convertNumber minFractionDigits="2" locale="PL"/>
                        </h:outputText>
                    </p:column>
                    <p:rowExpansion>
                        <p:column  headerText="wykaz transakcji" width="500" resizable="true" rendered="#{loop.platnosci.size() gt 0}">
                            <style>
                                .dokumentyZestawienie tr td {
                                    padding: 0px !important;
                                    margin: 0px !important;
                                }
                            </style>
                            <p:dataTable styleClass="dokumentyZestawienie" var="subwpis" value="#{loop.platnosci}" 
                                         emptyMessage="brak transakcji"  resizableColumns="true" style="width: 90%; float: right;">
                                <p:column headerText="#{mgs.kwotatrans}" >
                                    <h:outputText value="#{subwpis.kwotatransakcji}" style="float: right;">
                                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="#{mgs.datatrans}">
                                    <h:outputText value="#{subwpis.datarozrachunku}" style="float: right;">
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="#{mgs.kwotarozl}">
                                    <h:outputText value="#{subwpis.rozliczajacy.kwotaR}" style="float: right;">
                                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="#{mgs.kurs}" sortBy="#{subwpis.rozliczajacy.wiersz.tabelanbp.kurssredni}" width="40" rendered="#{loop.wiersz.tabelanbp.waluta.symbolwaluty ne 'PLN'}">
                                    <h:outputText value="#{subwpis.rozliczajacy.wiersz.tabelanbp.kurssredni}"/>
                                </p:column>
                                <p:column headerText="#{mgs.różnicekurs}" rendered="#{loop.wiersz.tabelanbp.waluta.symbolwaluty ne 'PLN'}">
                                    <h:outputText value="#{subwpis.roznicekursowe}" style="float: right;">
                                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="#{mgs.nrdokrozl}" style="text-align: center;">
                                    <h:outputText value="#{subwpis.rozliczajacy.wiersz.dokfk.seriadokfk}/#{subwpis.rozliczajacy.wiersz.dokfk.nrkolejnywserii}"/>
                                </p:column>
                                <p:column headerText="#{mgs.lpwiersza}" style="text-align: center;">
                                    <h:outputText value="#{subwpis.rozliczajacy.wiersz.idporzadkowy}"/>
                                </p:column>
                                <p:column headerText="#{mgs.numerwlasny}">
                                    <h:outputText value="#{subwpis.rozliczajacy.wiersz.dokfk.numerwlasnydokfk}"/>
                                </p:column>
                                <p:column headerText="#{mgs.opis}" width="280">
                                    <h:outputText value="#{subwpis.rozliczajacy.wiersz.opisWiersza}"/>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:rowExpansion>
                </p:dataTable>
            </h:form>  
        </p:layoutUnit>  
        <p:layoutUnit position="south">  
            <p:panelGrid id="sumy" columns="8" style="float: right; width: 1000px;">
                <h:form>
                    <p:selectOneMenu label="stan" value="#{rozrachunkiPrzegladView.coWyswietlacRozrachunkiPrzeglad}" style="width: 200px;" >
                        <p:ajax event="change" listener="#{rozrachunkiPrzegladView.pobierzZapisyZmianaZakresu}" update=":tabelanowerozrachunki:tabela" partialSubmit="true"/>
                        <f:selectItem itemLabel="#{mgs.wszystkie}" itemValue="wszystkie"/>
                        <f:selectItem itemLabel="#{mgs.rozliczone}" itemValue="rozliczone"/>
                        <f:selectItem itemLabel="#{mgs.częściowo}" itemValue="częściowo"/>
                        <f:selectItem itemLabel="#{mgs.nowe}" itemValue="nowe"/>
                    </p:selectOneMenu>
                </h:form>
            </p:panelGrid>
        </p:layoutUnit>  
    </p:layout>  

</ui:composition>


