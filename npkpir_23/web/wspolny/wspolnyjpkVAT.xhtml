<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:form id="form_dialog_jpk_vat" >
        <p:outputPanel rendered="#{jPK_VAT2View.jpkrazemzdeklaracja}" style="padding: 5px;">
            <h:outputText value="#{jPK_VAT2View.wynikszukaniadeklaracji}" style="color: blue;"/>
        </p:outputPanel>
        <p:panel header="wygeneruj JPK VAT za #{WpisView.miesiacWpisu}/#{WpisView.rokWpisuSt}" style="width: 1250px;"/>
        <p:panelGrid columns="5" rendered="#{WpisView.podatnikObiekt.nip ne '5263158333'}">
            <p:commandButton value="wyślij jpkfk" actionListener="#{jPK_VAT2View.przygotujXMLFK()}" update="@form form_dialog_jpk_vat:tabela" style="width: 120px;" rendered="#{!jPK_VAT2View.nowa0korekta1 and jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <p:commandButton value="wyślij korektafk" actionListener="#{jPK_VAT2View.przygotujXMLFK()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.nowa0korekta1 and jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <p:commandButton value="wyślij jpk" actionListener="#{jPK_VAT2View.przygotujXML()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <p:commandButton value="wyślij korekta" actionListener="#{jPK_VAT2View.przygotujXML()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <p:commandButton value="podgląd jpkfk" actionListener="#{jPK_VAT2View.przygotujXMLFKPodglad()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <p:commandButton value="podgląd jpk" actionListener="#{jPK_VAT2View.przygotujXMLPodglad()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <p:commandButton value="pobierz jpkfk" actionListener="#{jPK_VAT2View.przygotujXMLFKDL()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <p:commandButton value="pobierz jpk" actionListener="#{jPK_VAT2View.przygotujXMLDL()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.pkpir0ksiegi1 and jPK_VAT2View.moznawysylacjpk}"/>
            <h:outputText value="wersja jpk (0 - jpk pierwotne)" style="margin-left: 200px;"/>
            <p:selectOneMenu value="#{jPK_VAT2View.werjsajpkrecznie}" label="wersja jpk">
                <f:selectItem itemValue="0" itemLabel="0"/>
                <f:selectItem itemValue="1" itemLabel="1"/>
                <f:selectItem itemValue="2" itemLabel="2"/>
                <f:selectItem itemValue="3" itemLabel="3"/>
                <f:selectItem itemValue="4" itemLabel="4"/>
                <f:selectItem itemValue="5" itemLabel="5"/>
                <p:ajax event="change" partialSubmit="true"/>
            </p:selectOneMenu>
        </p:panelGrid>
        <p:panelGrid columns="5" rendered="#{WpisView.podatnikObiekt.nip eq '5263158333'}">
            <p:commandButton value="wyślij jpk" actionListener="#{jPK_VAT2View.przygotujXMLDedra()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="wyślij korekta" actionListener="#{jPK_VAT2View.przygotujXMLDedra()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="podgląd jpk" actionListener="#{jPK_VAT2View.przygotujXMLPodgladDedra()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="pobierz jpk" actionListener="#{jPK_VAT2View.przygotujXMLDedraDL()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.pkpir0ksiegi1}"/>
            <h:outputText value="wersja jpk (0 - jpk pierwotne)" style="margin-left: 200px;"/>
            <p:selectOneMenu value="#{jPK_VAT2View.werjsajpkrecznie}" label="wersja jpk">
                <f:selectItem itemValue="0" itemLabel="0"/>
                <f:selectItem itemValue="1" itemLabel="1"/>
                <f:selectItem itemValue="2" itemLabel="2"/>
                <f:selectItem itemValue="3" itemLabel="3"/>
                <f:selectItem itemValue="4" itemLabel="4"/>
                <f:selectItem itemValue="5" itemLabel="5"/>
                <p:ajax event="change" partialSubmit="true"/>
            </p:selectOneMenu>
        </p:panelGrid>
        <p:messages id="wiadomoscjpk"/>
        <p:dataTable value="#{jPK_VAT2View.bledy}" var="itemblad" rowIndexVar="index" id="tabelablad" style="width: 1250px; margin-top: 10px;"
                     sortBy="#{itemblad.miesiac}" rendered="#{jPK_VAT2View.bledy ne null and jPK_VAT2View.bledy.size() gt 0}"
                     selection="#{jPK_VAT2View.selected}" selectionMode="single" rowKey="#{itemblad.hash()}"
                     emptyMessage="brak bledów w dokumentach">
            <p:ajax event="rowToggle" global="false"/>
                <p:column style="width: 20px; text-align: center;">
                    <p:rowToggler/>
                </p:column>
            <f:facet name="header">
                <h:outputText value="Dokumenty z błędami"/>
            </f:facet>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="data sprz."/>
                </f:facet>
                <h:outputText value="#{itemblad.dataSprz}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="data wyst"/>
                </f:facet>
                <h:outputText value="#{itemblad.dataWyst}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="nr dok"/>
                </f:facet>
                <h:outputText value="#{itemblad.nrWlDk}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="opis"/>
                </f:facet>
                <h:outputText value="#{itemblad.opis}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="netto"/>
                </f:facet>
                <h:outputText value="#{itemblad.netto}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="vat"/>
                </f:facet>
                <h:outputText value="#{itemblad.vat}" />
            </p:column>
        </p:dataTable>
        <p:dataTable value="#{jPK_VAT2View.lista}" var="item" rowIndexVar="index" id="tabela" style="width: 1250px; margin-top: 10px; height: 650px;overflow-y: scroll;"
                      sortBy="#{item.miesiac}"
                     selection="#{jPK_VAT2View.selected}" selectionMode="single" rowKey="#{item.id}"
                     emptyMessage="nie wysłano jeszcze plików jpk">
            <p:ajax event="rowToggle" global="false"/>
                <p:column style="width: 20px; text-align: center;">
                    <p:rowToggler/>
                </p:column>
            <f:facet name="header">
                <h:outputText value="Wysłane jpk"/>
            </f:facet>
            <p:column style="width: 20px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="lp"/>
                </f:facet>
                <h:outputText value="#{index+1}" />
            </p:column>
             <p:column style="width: 20px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="v"/>
                </f:facet>
                 <h:outputText value="#{item.getJpkWersja()}" style="color: #{item.getJpkWersja() eq 'kor.'? 'red':initial}"/>
            </p:column>
            <p:column style="width: 30px; text-align: center;" sortBy="#{item.miesiac}">
                <f:facet name="header">
                    <h:outputText value="mc"/>
                </f:facet>
                <h:outputText value="#{item.miesiac}"/>
            </p:column>
            <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="wynik"/>
                </f:facet>
                <h:outputText value="#{item.code}"/>
            </p:column>
            <p:column style="width: 150px;" >
                <f:facet name="header">
                    <h:outputText value="status"/>
                </f:facet>
                <h:outputText value="#{item.description}"/>
            </p:column>
            <p:column style="width: 150px;" >
                <f:facet name="header">
                    <h:outputText value="opis"/>
                </f:facet>
                <h:outputText value="#{item.details}"/>
            </p:column>
            <p:column style="width: 120px; text-align: center;" >
                <f:facet name="header">
                    <h:outputText value="numer własny"/>
                </f:facet>
                <h:outputText value="#{item.referenceNumber}"/>
            </p:column>
            <p:column style="width: 90px; text-align: center;" >
                <f:facet name="header">
                    <h:outputText value="data przyjęcia"/>
                </f:facet>
                <h:outputText value="#{item.timestampData}">
                    <f:convertDateTime locale="pl"/>
                </h:outputText>
            </p:column>
            <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="upo"/>
                </f:facet>
                <p:commandButton icon="fa fa-archive" actionListener="#{jPK_VAT2View.pobierzUPO(item)}" update="@form"/>
            </p:column>
             <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="print"/>
                </f:facet>
                 <p:commandButton icon="fa fa-print" actionListener="#{jPK_VAT2View.drukujUPO(item)}"  global="false"/>
            </p:column>
            <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="zachowaj"/>
                </f:facet>
                <p:commandButton icon="fa fa-save" actionListener="#{jPK_VAT2View.zachowajJPK(item)}"  global="false" />
            </p:column>
            <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="usuń"/>
                </f:facet>
                <p:commandButton icon="fa fa-trash" onclick="PF('confirmation').show()" update="@form" global="false" />
            </p:column>
            <p:rowExpansion>
                <p:panelGrid columns="1">
                    <h:outputText value="#{item.getJpkNaglowek()}"/>
                <p:dataTable value="#{item}" var="itemik">
                        <p:column headerText="data jpk" width="80">
                            <h:outputText value="#{itemik.datajpk}">
                                <f:convertDateTime pattern="dd/MM/yyy HH:mm"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="data upo" width="80">
                            <h:outputText value="#{itemik.dataupo}">
                                <f:convertDateTime pattern="dd/MM/yyy HH:mm"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="sporządził" width="100">
                            <h:outputText value="#{itemik.wprowadzil.imie} #{itemik.wprowadzil.nazw}"/>
                        </p:column>
                        <p:column headerText="upo">
                            <h:outputText value="#{itemik.potwierdzenie.toString()}"/>
                        </p:column>
                 </p:dataTable>
                </p:panelGrid>
            </p:rowExpansion>
        </p:dataTable>
    </h:form>
</html>


