<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:form id="form_dialog_jpk_vat" >
        <p:panel header="wygeneruj JPK VAT za #{WpisView.miesiacWpisu}/#{WpisView.rokWpisuSt}" style="width: 1250px;"/>
        <p:panelGrid columns="2" rendered="#{WpisView.podatnikObiekt.nip ne '5263158333'}">
            <p:commandButton value="wyślij jpkfk" actionListener="#{jPK_VAT2View.przygotujXMLFK()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.nowa0korekta1 and jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="wyślij korektafk" actionListener="#{jPK_VAT2View.przygotujXMLFK()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.nowa0korekta1 and jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="wyślij jpk" actionListener="#{jPK_VAT2View.przygotujXML()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="wyślij korekta" actionListener="#{jPK_VAT2View.przygotujXML()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="podgląd jpkfk" actionListener="#{jPK_VAT2View.przygotujXMLFKPodglad()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="podgląd jpk" actionListener="#{jPK_VAT2View.przygotujXMLPodglad()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.pkpir0ksiegi1}"/>
        </p:panelGrid>
        <p:panelGrid columns="2" rendered="#{WpisView.podatnikObiekt.nip eq '5263158333'}">
            <p:commandButton value="wyślij jpk" actionListener="#{jPK_VAT2View.przygotujXMLDedra()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="wyślij korekta" actionListener="#{jPK_VAT2View.przygotujDedra()}" update="@form" style="width: 120px;" rendered="#{jPK_VAT2View.nowa0korekta1 and !jPK_VAT2View.pkpir0ksiegi1}"/>
            <p:commandButton value="podgląd jpk" actionListener="#{jPK_VAT2View.przygotujXMLPodgladDedra()}" update="@form" style="width: 120px;" rendered="#{!jPK_VAT2View.pkpir0ksiegi1}"/>
        </p:panelGrid>
        
        <p:dataTable value="#{jPK_VAT2View.bledy}" var="itemblad" rowIndexVar="index" id="tabelablad" style="width: 1250px; margin-top: 10px;"
                     sortBy="#{itemblad.miesiac}" rendered="#{jPK_VAT2View.bledy ne null and jPK_VAT2View.bledy.size() gt 0}"
                     selection="#{jPK_VAT2View.selected}" selectionMode="single" rowKey="#{itemblad.hash()}"
                     emptyMessage="brak bledów w dokumentach">
            <p:ajax event="rowToggle" global="false"/>
                <p:column style="width: 20px; text-align: center;">
                    <p:rowToggler/>
                </p:column>
            <f:facet name="header">
                <h:outputText value="Dokumenty z błędami"/>
            </f:facet>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="data sprz."/>
                </f:facet>
                <h:outputText value="#{itemblad.dataSprz}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="data wyst"/>
                </f:facet>
                <h:outputText value="#{itemblad.dataWyst}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="nr dok"/>
                </f:facet>
                <h:outputText value="#{itemblad.nrWlDk}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="opis"/>
                </f:facet>
                <h:outputText value="#{itemblad.opis}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="netto"/>
                </f:facet>
                <h:outputText value="#{itemblad.netto}" />
            </p:column>
            <p:column >
                <f:facet name="header">
                    <h:outputText value="vat"/>
                </f:facet>
                <h:outputText value="#{itemblad.vat}" />
            </p:column>
        </p:dataTable>
        <p:dataTable value="#{jPK_VAT2View.lista}" var="item" rowIndexVar="index" id="tabela" style="width: 1250px; margin-top: 10px;"
                      sortBy="#{item.miesiac}"
                     selection="#{jPK_VAT2View.selected}" selectionMode="single" rowKey="#{item.id}"
                     emptyMessage="nie wysłano jeszcze plików jpk">
            <p:ajax event="rowToggle" global="false"/>
                <p:column style="width: 20px; text-align: center;">
                    <p:rowToggler/>
                </p:column>
            <f:facet name="header">
                <h:outputText value="Wysłane jpk"/>
            </f:facet>
            <p:column style="width: 20px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="lp"/>
                </f:facet>
                <h:outputText value="#{index+1}" />
            </p:column>
             <p:column style="width: 20px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="v"/>
                </f:facet>
                 <h:outputText value="#{item.getJpkWersja()}" />
            </p:column>
            <p:column style="width: 30px; text-align: center;" sortBy="#{item.miesiac}">
                <f:facet name="header">
                    <h:outputText value="mc"/>
                </f:facet>
                <h:outputText value="#{item.miesiac}"/>
            </p:column>
            <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="wynik"/>
                </f:facet>
                <h:outputText value="#{item.code}"/>
            </p:column>
            <p:column style="width: 150px;" >
                <f:facet name="header">
                    <h:outputText value="status"/>
                </f:facet>
                <h:outputText value="#{item.description}"/>
            </p:column>
            <p:column style="width: 150px;" >
                <f:facet name="header">
                    <h:outputText value="opis"/>
                </f:facet>
                <h:outputText value="#{item.details}"/>
            </p:column>
            <p:column style="width: 120px; text-align: center;" >
                <f:facet name="header">
                    <h:outputText value="numer własny"/>
                </f:facet>
                <h:outputText value="#{item.referenceNumber}"/>
            </p:column>
            <p:column style="width: 90px; text-align: center;" >
                <f:facet name="header">
                    <h:outputText value="data przyjęcia"/>
                </f:facet>
                <h:outputText value="#{item.timestamp.substring(0,16)}">
                </h:outputText>
            </p:column>
            <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="upo"/>
                </f:facet>
                <p:commandButton icon="fa fa-archive" actionListener="#{jPK_VAT2View.pobierzUPO(item)}" update="@form"/>
            </p:column>
             <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="print"/>
                </f:facet>
                 <p:commandButton icon="fa fa-print" actionListener="#{jPK_VAT2View.drukujUPO(item)}"  global="false"/>
            </p:column>
            <p:column style="width: 40px; text-align: center;">
                <f:facet name="header">
                    <h:outputText value="usuń"/>
                </f:facet>
                <p:commandButton icon="fa fa-trash" onclick="PF('confirmation').show()" update="@form" global="false" rendered="#{item.code gt 399}"/>
            </p:column>
            <p:rowExpansion>
                <p:panelGrid columns="1">
                    <h:outputText value="#{item.getJpkNaglowek()}"/>
                <p:dataTable value="#{item}" var="itemik">
                        <p:column headerText="data jpk" width="80">
                            <h:outputText value="#{itemik.datajpk}">
                                <f:convertDateTime pattern="dd/MM/yyy HH:mm"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="data upo" width="80">
                            <h:outputText value="#{itemik.dataupo}">
                                <f:convertDateTime pattern="dd/MM/yyy HH:mm"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="sporządził" width="100">
                            <h:outputText value="#{itemik.wprowadzil.imie} #{itemik.wprowadzil.nazw}"/>
                        </p:column>
                        <p:column headerText="upo">
                            <h:outputText value="#{itemik.potwierdzenie.toString()}"/>
                        </p:column>
                 </p:dataTable>
                
                </p:panelGrid>
            </p:rowExpansion>
        </p:dataTable>
    </h:form>
</html>


