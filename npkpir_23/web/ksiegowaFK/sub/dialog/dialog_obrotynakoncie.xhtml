<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    >

    <p:dialog id="obroty" header="Orboty na kontach" widgetVar="obrotynakoncie" 
              resizable="false" onShow="ustawdialog('obroty','menuraporty',1250,750);" onHide="resetujdialog('obroty');"  closeOnEscape="true"  
              >
        <p:layout fullPage="false" style="width: 1270px; height: 700px;">  
            <p:layoutUnit position="north" >
                <h:form id="formobrotykonta">
                    <h:outputText value="wybierz konto: "/>
                    <p:autoComplete id="kontoma" value="#{kontoObrotyFKView.wybranekonto}" completeMethod="#{kontoView.complete}"
                                    var="p" itemLabel="#{p.pelnynumer} #{p.nazwapelna}" itemValue="#{p}"
                                    minQueryLength="1" maxResults="15" maxlength="10" converter="KontoConv"
                                    converterMessage="Nieudana konwersja Klient"
                                    styleClass="kontoinput" 
                                    >
                        <p:ajax event="keyup"  listener="#{kontoObrotyFKView.pobierzZapisyNaKoncie}" update=":formobroty:dataListObroty, :tabelazobrotami:tabelaobroty, :sumyobroty"/>
                        <p:ajax event="blur"  listener="#{kontoObrotyFKView.pobierzZapisyNaKoncie}" update=":formobroty:dataListObroty, :tabelazobrotami:tabelaobroty, :sumyobroty"/>
                    </p:autoComplete>
                </h:form>
            </p:layoutUnit>  
           
            <p:layoutUnit position="west" size="350">
                 <p:panelGrid columns="2" >
                <p:commandButton id="rozwinwszobroty" value="rozwiń wszystkie" actionListener="#{planKontView.rozwinwszystkie(planKontView.root)}" update=":formobroty:dataListObroty" style="float: left;" />
                <p:commandButton id="zwinwszobroty" value="zwiń wszystkie" actionListener="#{planKontView.zwinwszystkie(planKontView.root)}" update=":formobroty:dataListObroty" style="float: left;" />
            </p:panelGrid>
                <h:form id="formobroty">
                    <p:hotkey bind="down"  global="false" onstart="przejdzwiersz('formobroty:dataListObroty_data','formobroty:dataListObroty','zmiennazapisy');"/>
                    <p:hotkey bind="up"  global="false" onstart="wrocwiersz('formobroty:dataListObroty_data','formobroty:dataListObroty','zmiennazapisy');"/>
                    <p:treeTable id="dataListObroty" value="#{planKontView.root}" var="loop" selectionMode="single" selection="#{kontoObrotyFKView.wybranekontoNode}"  
                                  >
                        <p:ajax event="select" update=":formobrotykonta:kontoma, :tabelazobrotami:tabelaobroty, :sumyobroty" listener="#{kontoObrotyFKView.pobierzZapisyNaKoncieNode}" />
                        <p:ajax event="unselect" update=":formobrotykonta:kontoma, :tabelazobrotami:tabelaobroty, :sumyobroty" listener="#{kontoObrotyFKView.pobierzZapisyNaKoncieNodeUnselect}" />
                        <p:column headerText="nr konta" style="width: 100px; height: 40px;" styleClass="#{loop.level eq 2 ? 'druga' : null}">
                            <h:outputText value="#{loop.pelnynumer}" /> 
                        </p:column>
                        <p:column headerText="nazwa pełna" >
                            <h:outputText value="#{loop.nazwapelna}" /> 
                        </p:column>
                    </p:treeTable>>
                </h:form>
            </p:layoutUnit>  
<!--            <p:layoutUnit position="east" size="200">  
            </p:layoutUnit>  -->
            <p:layoutUnit position="center" style="min-width: 870px;">
                <h:form id="tabelazobrotami">  
                    <p:dataTable id="tabelaobroty" value="#{kontoObrotyFKView.lista}" var="loop" rowKey="#{loop.miesiac}" 
                                 selection="#{kontoObrotyFKView.wybranekontadosumowania}" style="width: 870px;" rowIndexVar="index"
                                 rowStyleClass="#{index eq 0 ? 'niebieskietlo' : null}"
                                 >
                        <p:ajax event="rowSelectCheckbox" update=":sumyobroty" listener="#{kontoObrotyFKView.sumazapisow}"/>
                        <p:ajax event="rowUnselectCheckbox" update=":sumyobroty" listener="#{kontoObrotyFKView.sumazapisow}"/>
                        <p:ajax event="toggleSelect" update=":sumyobroty" listener="#{kontoObrotyFKView.sumazapisow}"/>
                        <p:column selectionMode="multiple" width="35"></p:column>
                        <p:column headerText="miesiąc" width="70" sortBy="#{loop.miesiac}">
                            <h:outputText value="#{loop.miesiac}"/>
                        </p:column>
                        <p:column headerText="kwota Wn" sortBy="#{loop.kwotaWn}">
                             <h:outputText value="#{loop.kwotaWn}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                        <p:column headerText="kwota Ma" sortBy="#{loop.kwotaMa}">
                            <h:outputText value="#{loop.kwotaMa}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                        <p:column headerText="suma Wn" sortBy="#{loop.kwotaWnnarastajaco}">
                            <h:outputText value="#{loop.kwotaWnnarastajaco}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                        <p:column headerText="suma Ma" sortBy="#{loop.kwotaManarastajaco}">
                            <h:outputText value="#{loop.kwotaManarastajaco}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                        <p:column headerText="saldo Wn" sortBy="#{loop.kwotaWnsaldo}">
                            <h:outputText value="#{loop.kwotaWnsaldo}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                        <p:column headerText="saldo Ma" sortBy="#{loop.kwotaMasaldo}">
                            <h:outputText value="#{loop.kwotaMasaldo}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                       
                    </p:dataTable>
               </h:form>  
            </p:layoutUnit>  
            <p:layoutUnit position="south">  
                <p:panelGrid id="sumyobroty" columns="8" style="float: right; width: 1000px;">
                    <h:outputText value="suma zapisów Wn"/><h:outputText value="#{kontoObrotyFKView.sumaWn}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                    <h:outputText value="suma zapisów Ma"/><h:outputText value="#{kontoObrotyFKView.sumaMa}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                    <h:outputText value="saldo zapisów Wn"/><h:outputText value="#{kontoObrotyFKView.saldoWn}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                    <h:outputText value="saldo zapisów Ma"/><h:outputText value="#{kontoObrotyFKView.saldoMa}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                </p:panelGrid>
            </p:layoutUnit>  
        </p:layout>  
    </p:dialog>
</ui:composition>

