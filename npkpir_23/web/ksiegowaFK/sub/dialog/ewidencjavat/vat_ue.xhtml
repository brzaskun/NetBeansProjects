<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"

    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:bcf="http://brzaskun.com/facelets">
    <p:tab title="VAT UE">
        <p:panelGrid id="panelue" columns="8">
            <h:outputText value="suma wybranych"/>
            <bcf:outputpl value="#{vatUeFKView.sumawybranych}"/>
            <p:commandButton value="#{mgs.drukuj}" style="margin-left: 3%; margin-bottom: 1%; width: 120px;" actionListener="#{vatUeFKView.drukujewidencjeUEfk()}"/>
            <p:commandButton value="#{mgs.drukujtab}" style="margin-left: 10px; margin-bottom: 1%; width: 120px;" actionListener="#{vatUeFKView.drukujewidencjeUEfkTabela()}"/>
            <p:commandButton value="rozwiń/zwiń" style="margin-left: 10px; margin-bottom: 1%; width: 120px;" onclick="jQuery('.ui-row-toggler').click()" global="false"/>
            <p:commandButton value="deklaracja" style="margin-left: 10px; margin-bottom: 1%; width: 120px;" actionListener="#{vATUEDeklaracjaView.tworzdeklarajce(vatUeFKView.klienciWDTWNT)}"/>
            <p:commandButton value="VIES" style="margin-left: 10px; margin-bottom: 1%; width: 120px;" actionListener="#{vatUeFKView.sprawdzVIES}"
                             update="form:akordeon:formVATUE:dokumentyLista" oncomplete="r('form:akordeon:drukviesbutton').show()"/>
            <p:commandButton value="druk VIES" style="margin-left: 10px; margin-bottom: 1%; width: 120px; display: none;" id="drukviesbutton"
                             actionListener="#{vatUeFKView.drukujVIES}"
                             />
        </p:panelGrid>
        <h:form id="formVATUE">
            <p:outputPanel id="wrapper"> 

                <p:dataTable  var="wpis1" value="#{vatUeFKView.klienciWDTWNT}" id="dokumentyLista" 
                              rowKey="#{wpis1.hashCode()}" selection="#{vatUeFKView.listawybranych}"
                              emptyMessage="W danym miesiącu nie było żadnych zapisów"
                              sortBy="#{wpis1.kontrahent.npelna}"
                              style="height: 570px;overflow-y: scroll;" widgetVar="dokTable" 
                              > 
                    <f:facet name="header">  
                        <h:outputText value="#{vatUeFKView.opisvatuepkpir}" /> 
                        <h:outputText value="- wyszukiwanie: " />  
                        <p:inputText id="globalFilter" onkeyup="PF('dokTable').filter()" style="width:180px" placeholder="wyszukiwane wyrażenie" />  
                    </f:facet>
                    <p:ajax event="rowSelectCheckbox"  global="false" listener="#{vatUeFKView.podsumuj()}" update="form:akordeon:panelue"/>
                    <p:ajax event="rowUnselectCheckbox" global="false" listener="#{vatUeFKView.podsumuj()}" update="form:akordeon:panelue"/>
                    <p:ajax event="toggleSelect" global="false"  listener="#{vatUeFKView.podsumuj()}" update="form:akordeon:panelue"/>
                    <p:ajax event="rowToggle" global="false"/>
                    <p:column selectionMode="multiple" width="30" style="text-align: center;" rendered="#{wpis1.transakcja ne 'podsumowanie'}"/>
                    <p:column width="30" style="text-align: center;" rendered="#{wpis1.transakcja eq 'podsumowanie'}"/>
                    <p:column style="width: 5%;">
                        <p:rowToggler rendered="#{wpis1.zawierafk.size() gt 0 ? true : false}"/>
                    </p:column>
                    <p:column id="typdokColumn" headerText="transakcja" filterBy="#{wpis1.transakcja}" filterMatchMode="contains" sortBy="#{wpis1.transakcja}" style="width: 15%;" filterStyle="display : none;" >  
                        <h:outputText value="#{wpis1.transakcja}"/>
                    </p:column>
                    <p:column id="krajkodColumn" headerText="kraj" filterBy="#{wpis1.kontrahent.krajkod}" filterMatchMode="contains" sortBy="#{wpis1.kontrahent.krajkod}" 
                              style="width: 15%; text-align: center;" filterStyle="display : none;" >  
                        <h:outputText value="#{wpis1.kontrahent.krajkod}"/>
                    </p:column>
                    <p:column id="nipColumn" headerText="nip" filterBy="#{wpis1.kontrahent.nip}" 
                              filterMatchMode="contains" sortBy="#{wpis1.kontrahent.nip}" style="width: 20%;" filterStyle="display : none;" >  
                        <h:outputText value="#{wpis1.kontrahent.nip}" />
                    </p:column>
                    <p:column id="kontrColumn" headerText="#{mgs.kontrahent}" filterBy="#{wpis1.kontrahent.npelna}" filterMatchMode="contains" 
                              sortBy="#{wpis1.kontrahent.npelna}" style="width: 20%;" filterStyle="display : none;" width="300">  
                        <h:outputText value="#{wpis1.kontrahent.npelna}"  />
                    </p:column>
                    <p:column id="nettoColumn" headerText="#{mgs.netto} pln" filterBy="#{wpis1.netto}" filterMatchMode="contains" sortBy="#{wpis1.netto}" style="width: 15%;" filterStyle="display : none;" >  
                        <h:outputText value="#{wpis1.netto}" style="float: right;">
                            <f:convertNumber minFractionDigits="2" locale="PL"/>
                        </h:outputText>
                    </p:column>
                    <p:column id="nettoWalutaColumn" headerText="#{mgs.netto} #{mgs.waluta}" filterBy="#{wpis1.nettowaluta}" filterMatchMode="contains" sortBy="#{wpis1.nettowaluta}" style="width: 15%;" filterStyle="display : none;" >  
                        <h:outputText value="#{wpis1.nettowaluta}" style="float: right;">
                            <f:convertNumber minFractionDigits="2" locale="PL"/>
                        </h:outputText>
                    </p:column>
                    <p:column id="nettoWaluta" filterBy="#{wpis1.nazwawaluty}" filterMatchMode="contains" sortBy="#{wpis1.nazwawaluty}" style="width: 40px; text-align: center;" filterStyle="display : none;" >  
                        <h:outputText value="#{wpis1.nazwawaluty}"/>
                    </p:column>
                    <p:column id="liczbaColumn" headerText="ilość dok" filterBy="#{wpis1.liczbadok}" filterMatchMode="contains" sortBy="#{wpis1.liczbadok}" style="width: 15%;text-align: center;" filterStyle="display : none;" >  
                        <h:outputText value="#{wpis1.liczbadok}" rendered="#{wpis1.transakcja eq 'podsum.' ? false : true}">
                            <f:convertNumber minFractionDigits="0" locale="PL"/>
                        </h:outputText>
                    </p:column>
                    <p:column id="vies" headerText="VIES" sortBy="#{wpis1.vies}" style="width: 15%; text-align: center;">  
                         <h:outputText value="#{wpis1.vies eq null ? 'nie sprawdzono' : wpis1.vies.wynikVies}" rendered="#{wpis1.transakcja eq 'podsum.' ? false : true}"
                                       style="#{wpis1.vies.identyfikatorsprawdzenia eq null or wpis1.vies.uwagi ne null ? 'color: red;':'color: green;'}">
                        </h:outputText>
                    </p:column>
                    
                    <p:rowExpansion>
                        <p:column id="ewidencjavat" headerText="dokumenty podsumowane" width="300" resizable="true" >  
                            <p:dataTable var="subwpis" value="#{wpis1.zawierafk}" emptyMessage="brak dokumentów"  resizableColumns="true" style="width: 98%;">
                                <p:column id="SubColumn1" headerText="data wyst" width="70">  
                                    <h:outputText value="#{subwpis.datadokumentu}" />
                                </p:column>
                                <p:column headerText="symbol" width="90">  
                                    <h:outputText value="#{subwpis.dokfkSN}" />
                                </p:column>
                                <p:column id="SubColumn1b" headerText="nr własny" width="120">  
                                    <h:outputText value="#{subwpis.numerwlasnydokfk}" />
                                </p:column>
                                <p:column id="SubColumn1c" headerText="#{mgs.opis}" width="250">  
                                    <h:outputText value="#{subwpis.opisdokfk}" />
                                </p:column>
                                <p:column id="SubColumn1a"  headerText="wartość netto w pln">  
                                    <h:outputText value="#{subwpis.nettoPLNWNT}" style="float: right;">
                                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="wartość VAT">  
                                    <h:outputText value="#{subwpis.getVATPLNWNT()}" style="float: right;">
                                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                                    </h:outputText>
                                </p:column>
                                <p:column id="SubColumn1e"  headerText="netto w wal.">  
                                    <h:outputText value="#{subwpis.nettoWALWNT}" style="float: right;">
                                        <f:convertNumber minFractionDigits="2" locale="PL"/>
                                    </h:outputText>
                                </p:column>
                                <p:column id="SubColumn0" headerText="waluta" style="text-align: center;" width="40">  
                                    <h:outputText value="#{subwpis.walutadokumentu.symbolwaluty}" />
                                </p:column>
                                <p:column id="SubColumn4" headerText="okresy vat">  
                                    <h:outputText value="#{subwpis.vatM}/#{subwpis.vatR}" style="float: right;"/>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:rowExpansion>
                </p:dataTable>
                <p:separator/>
<!--                            <p:dataTable value="#{vatUeFKView.danezdeklaracji}" var="row" emptyMessage="brak wysłanych deklaracji za okres" style="max-width: 35%">
                    <p:column>
                        <h:outputText value="#{row.nazwa}"/>
                    </p:column>
                    <p:column headerText="#{mgs.miesiąc}" style="text-align: center;">
                        <h:outputText value="#{row.miesiac}"/>
                    </p:column>
                    <p:column headerText="#{mgs.wartość}">
                        <h:outputText value="#{row.netto}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/>
                        </h:outputText>
                    </p:column>
                </p:dataTable>-->
            </p:outputPanel>
        </h:form>
        <h:outputText value="Uwaga! Sumowane są zapisy księgowe w danym dokumnecie, jeżeli oprócz kwot bezposrednio z dokumentu dokonano księgowań równoległych sumy w tabeli nie będa prawidłowe"
                      style="color: red;"/>
    </p:tab>
</ui:composition>
