<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ck="http://code.google.com/ck-jsf-editor"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:bcf="http://brzaskun.com/facelets">
    <p:tabView id="akordeon">
        <p:tab title="wprowadź treść">
            <h:form id="formmail">
                <p:panelGrid columns="2">
                    <p:column>
                        <p:growl life="3600"  id="messages" autoUpdate="true"/>
                       <p:editor id="editor"  widgetVar="editorWidget" value="#{adminMailView.zawartoscmaila}" width="1200" height="600"/>
                       <p:commandButton value="Save" actionListener="#{adminMailView.zachowajMaila}" style="margin-left: 10px; width: 120px; margin-top: 10px;" icon="ui-icon-disk"  update=":akordeon:wysylanie:wprowadzonymail"/>
                       <p:commandButton value="Reset" type="button" onclick="PF('editorWidget').clear();" style="margin-left: 10px; width: 120px; margin-top: 10px;" icon="ui-icon-close"  update=":akordeon:wysylanie:wprowadzonymail"/>
                    </p:column>
                </p:panelGrid>
            </h:form>
        </p:tab>
        <p:tab title="adresaci">
            <p:dataTable value="#{adminMailView.klientList}" var="loop" rowIndexVar="index" style="width: 1000px;">
                <f:facet name="header">
                    <h:outputText value="Wykaz adresatów"/>
                </f:facet>
                <p:column headerText="#{mgs.numerkolejny}">
                    <h:outputText value="#{index}"/>
                </p:column>
                <p:column headerText="nazwa">
                    <h:outputText value="#{loop.npelna}"/>
                </p:column>
                <p:column headerText="adres">
                    <h:outputText value="#{loop.email}"/>
                </p:column>
            </p:dataTable>
        </p:tab>
        <p:tab title="wyslij maila">
            <bcf:ajaxs/>
            <h:form id="wysylanie">
                <p:panelGrid columns="1">
                     <p:column>
                        <h:outputLabel value="wprowadz temat wiadomości: " for=":akordeon:wprowadzonymail"/>
                        <h:inputText value="#{adminMailView.tematwiadomosci}" label="temat wiadomości" style="width: 500px;"/>
                    </p:column>
                    <p:column>
                        <p:commandButton value="wyslij" actionListener="#{adminMailView.wyslijAdminMail()}" label="temat wiadomości" style="width: 300px;" update=":akordeon:formmaile:wyslenemaile"/>
                        <p:spacer width="10"/>
                        <p:commandButton value="test" actionListener="#{adminMailView.wyslijAdminMailTest()}" label="temat wiadomości" style="width: 300px;" update=":akordeon:formmaile:wyslenemaile"/>
                    </p:column>
                    <p:column>
                        <p:panel header="wprowadzona wiadomość" style="width: 800px; height: 250px;">
                            <h:outputText id="wprowadzonymail" value="#{adminMailView.zawartoscmaila}"/>
                        </p:panel>
                    </p:column>
                </p:panelGrid>
            </h:form>
        </p:tab>
        <p:tab title="wysłane maile">
            <h:form id="formmaile">
                <p:dataTable id="wyslenemaile" value="#{adminMailView.wyslanemaile}" var="loop" rowIndexVar="index" style="width: 1400px;" sortBy="#{loop.id}" sortOrder="descending">
                <p:ajax event="rowToggle" global="false" />
                <p:column style="height: 19px; text-align: center;" width="20">
                    <p:rowToggler />
                </p:column>
                <f:facet name="header">
                    <h:outputText value="Wykaz wysłanych maili"/>
                </f:facet>
                    <p:column headerText="#{mgs.numerkolejny}" width="30">
                    <h:outputText value="#{loop.id}"/>
                </p:column>
                    <p:column headerText="data wysyłki" width="150">
                        <h:outputText value="#{loop.datawysylki}">
                            <f:convertDateTime dateStyle="full" locale="pl"/>
                        </h:outputText>
                </p:column>
                    <p:column headerText="tytuł" width="250">
                    <h:outputText value="#{loop.tytul}"/>
                </p:column>
                <p:column headerText="treść">
                    <h:outputText value="#{loop.tresc}"/>
                </p:column>
                <p:column headerText="liczba maili" width="30">
                    <h:outputText value="#{loop.maile.size()}"/>
                </p:column>
                    <p:rowExpansion>
                        <p:dataTable value="#{loop.podatnicy}" var="loopik" rowIndexVar="index" style="width: 500px;">
                            <p:column width="40">
                                <h:outputText value="#{index+1}"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{loopik}"/>
                            </p:column>
                        </p:dataTable>
                    </p:rowExpansion>
            </p:dataTable>
                </h:form>
        </p:tab>
    </p:tabView>

</ui:composition>   

