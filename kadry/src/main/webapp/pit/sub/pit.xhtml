<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:bcf="http://brzaskun.com/facelets"
    >
    <p:tabView id="akordeon">
        <f:event type="preRenderView" listener="#{kartaWynagrodzenView.init()}"/>
        <p:tab title="zestawienie do PIT-11">
    <p:outputPanel>
        <p:commandButton value="pobierz" styleClass="buttonnorm" actionListener="#{kartaWynagrodzenView.init()}" update="akordeon:KartyWynangrodzenPITForm akordeon:wystawionepit11"/>
        <p:commandButton value="PIT-y 11" styleClass="buttonnorm2" actionListener="#{kartaWynagrodzenView.pit11All()}" update="akordeon:KartyWynangrodzenPITForm akordeon:wystawionepit11"/>
    </p:outputPanel>
    <p:outputPanel style="margin: 10px;">
        <h:form id="KartyWynangrodzenPITForm">
            <p:dataTable id="datalist" value="#{kartaWynagrodzenView.sumypracownicy}" var="itemkarta"
                         rowKey="#{itemkarta.angaz.id}" rowIndexVar="indexka" 
                         style="height: 350px; overflow-y: scroll;width: 1350px;" emptyMessage="Nie pobrano danych"
                         sortBy="#{itemkarta.nazwiskoiimie}" selection="#{kartaWynagrodzenView.listaselected}" rowSelectMode="add"
                         >
                <p:ajax event="rowSelectCheckbox"  partialSubmit="true" global="false"/>
                <p:ajax event="rowUnselectCheckbox" partialSubmit="true" global="false"/>
                <p:ajax event="rowSelect"  partialSubmit="true" global="false"/>
                <p:ajax event="rowUnselect"  partialSubmit="true" global="false"/>
                <f:facet name="header">
                    <h:outputText value="Zestawienie pracowników za rok #{wpisView.rokWpisu}"/>
                </f:facet>
                <p:column width="20" style="text-align: center;" selectionMode="multiple" selectRow="true" />
                <p:column width="20" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="id"/>
                    </f:facet>
                    <h:outputText value="#{indexka+1}"/>
                </p:column>
                <p:column width="200" style="text-align: left;" sortBy="#{itemkarta.nazwiskoiimie}" sortOrder="asc">
                    <f:facet name="header">
                        <h:outputText value="pracownik"/>
                    </f:facet>
                    <h:outputText value="#{itemkarta.nazwiskoiimie}" />
                </p:column>
                <p:column width="20" style="text-align: center;" >
                    <f:facet name="header">
                        <h:outputText value="US"/>
                    </f:facet>
                     <h:outputText  value="&#x2714;" rendered="#{itemkarta.angaz.pracownik.kodurzeduskarbowego ne null}" style="color: green;"/>
                </p:column>
                <p:column width="30" style="text-align: center;" >
                    <f:facet name="header">
                        <h:outputText value="wiek"/>
                    </f:facet>
                    <h:outputText value="#{itemkarta.wieklata}"  rendered="#{itemkarta.wieklata gt 26 and itemkarta.emeryt eq false}"/>
                    <h:outputText value="#{itemkarta.wieklata}"  style="color: green" rendered="#{itemkarta.wieklata lt 27 and itemkarta.emeryt eq false}"/>
                    <h:outputText value="#{itemkarta.wieklata}"  style="color: orange" rendered="#{itemkarta.emeryt eq true}"/>
                </p:column>
                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="brutto"/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.brutto}"/>
                </p:column>
                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="koszty uzysk."/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.kosztyuzyskania}"/>
                </p:column>
                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="dochód"/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.dochod}"/>
                </p:column>
                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="podatek"/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.podatekdochodowy}"/>
                </p:column>

                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="składki"/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.razemspolecznepracownik}"/>
                </p:column>
                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="zdrowotne potrąc."/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.praczdrowotnedopotracenia}"/>
                </p:column>
                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="zdrowotne odlicz."/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.praczdrowotnedoodliczenia}"/>
                </p:column>
                <p:column width="60">
                    <f:facet name="header">
                        <h:outputText value="wyn. netto"/>
                    </f:facet>
                    <bcf:outputpl value="#{itemkarta.netto}"/>
                </p:column>
                <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="koszty pod."/>
                    </f:facet>
                    <h:outputText  value="&#x2714;" rendered="#{itemkarta.kosztypodwyzszone}" styleClass="ww"/>
                </p:column>
                <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="koszty wiele um."/>
                    </f:facet>
                    <h:outputText  value="&#x2714;" rendered="#{itemkarta.kosztywieleumow}" styleClass="ww"/>
                </p:column>
                 <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="PIT-11"/>
                    </f:facet>
                     <h:outputText  value="&#x2714;" rendered="#{itemkarta.jestPIT11}" styleClass="ww"/>
                </p:column>
                <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="wysł"/>
                    </f:facet>
                    <h:outputText  value="&#x2714;" rendered="#{itemkarta.wyslano}" styleClass="ww"/>
                </p:column>
            </p:dataTable>
            <p:dataTable id="datalistpit" value="#{kartaWynagrodzenView.pitpola}" var="itempit"
                         rowKey="#{itempit.id}" rowIndexVar="indexpit"
                         style="height: 450px; overflow-y: scroll;width: 1050px;" emptyMessage="Nie pobrano danych"
                         sortBy="#{itempit.pracownik.nazwiskoImie}"  selection="#{kartaWynagrodzenView.wybranypitpola}" selectionMode="single"
                         >
                <f:facet name="header">
                    <h:outputText value="Zestawienie PIT #{wpisView.rokWpisu}"/>
                </f:facet>
                <p:column>
                    <p:panelGrid style="margin-top:20px" styleClass="pasekwync" columnClasses="no-border no-border">
                        <f:facet name="header">
                            <p:row>
                                <p:column colspan="9"><h:outputText value="#{itempit.pracownik.nazwiskoImie}"/></p:column>
                            </p:row>

                        </f:facet>
                        <p:row>
                            <p:row>
                                <p:column colspan="1" style="text-align: center;">lp</p:column>
                                <p:column colspan="3" style="text-align: center;" width="200">rodzaj przychodu</p:column>
                                <p:column colspan="1" style="text-align: center;">przychód</p:column>
                                <p:column colspan="1" style="text-align: center;">koszty</p:column>
                                <p:column colspan="1" style="text-align: center;">dochód</p:column>
                                <p:column colspan="1" style="text-align: center;">dochód zwolniony</p:column>
                                <p:column colspan="1" style="text-align: center;">zaliczka</p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="1" rowspan="2" style="text-align: center;">#{indexpit+1}</p:column>
                                <p:column colspan="3">umowa o pracę p.29</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.praca29przychod}" rendered="#{itempit.praca29przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.praca30koszt}" rendered="#{itempit.praca29przychod ne 0.0}"/></p:column>
                                <p:column colspan="1" rowspan="2"><bcf:outputpl value="#{itempit.praca31dochod}" rendered="#{itempit.praca29przychod ne 0.0}"/></p:column>
                                <p:column colspan="1" rowspan="2"><bcf:outputpl value="#{itempit.praca32dochodzwolniony}" rendered="#{itempit.praca29przychod ne 0.0}"/></p:column>
                                <p:column colspan="1" rowspan="2"><bcf:outputpl value="#{itempit.praca33zaliczka}" rendered="#{itempit.praca29przychod ne 0.0}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">umowa o pracę wyższe koszty p.34</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.praca34przychodwyzszekoszty}" rendered="#{itempit.praca34przychodwyzszekoszty ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.praca35wyzszekoszty}" rendered="#{itempit.praca34przychodwyzszekoszty ne 0.0}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="1" rowspan="2" style="text-align: center;">#{indexpit+2}</p:column>
                                <p:column colspan="3">emeryt umowa o pracę p.43</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.pracaemeryt43przychod}" rendered="#{itempit.pracaemeryt43przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.pracaemeryt44koszt}" rendered="#{itempit.pracaemeryt43przychod ne 0.0}"/></p:column>
                                <p:column colspan="1" rowspan="2"><bcf:outputpl value="#{itempit.pracaemeryt45dochod}" rendered="#{itempit.pracaemeryt43przychod ne 0.0}"/></p:column>
                                <p:column colspan="1" rowspan="2"><bcf:outputpl value="#{itempit.pracaemeryt46dochodzwolniony}" rendered="#{itempit.pracaemeryt43przychod ne 0.0}"/></p:column>
                                <p:column colspan="1" rowspan="2"><bcf:outputpl value="#{itempit.pracaemeryt47zaliczka}" rendered="#{itempit.pracaemeryt43przychod ne 0.0}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">emeryt umowa o pracę wyższe koszty p.34</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.pracaemeryt48przychodwyzszekoszty}" rendered="#{itempit.pracaemeryt48przychodwyzszekoszty ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.pracaemeryt49wyzszekoszty}" rendered="#{itempit.pracaemeryt48przychodwyzszekoszty ne 0.0}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="1" rowspan="1" style="text-align: center;">#{indexpit+3}</p:column>
                                <p:column colspan="3">pełnienie funkcji p.54</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.funkcja54przychod}" rendered="#{itempit.funkcja54przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.funkcja55koszt}" rendered="#{itempit.funkcja54przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.funkcja56dochod}" rendered="#{itempit.funkcja54przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.funkcja57zaliczka}" rendered="#{itempit.funkcja54przychod ne 0.0}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="1" rowspan="2" style="text-align: center;">#{indexpit+4}</p:column>
                                <p:column colspan="3">umowa zlecenia p.58</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie58przychod}" rendered="#{itempit.zlecenie58przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie59koszt}" rendered="#{itempit.zlecenie58przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie60dochod}" rendered="#{itempit.zlecenie58przychod ne 0.0}"/></p:column>
                                <p:column colspan="1"></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie61zaliczka}" rendered="#{itempit.zlecenie58przychod ne 0.0}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">umowa zlecenia 26 opodatkowana p.62</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie62przychod26}" rendered="#{itempit.zlecenie62przychod26 ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie63koszt26}" rendered="#{itempit.zlecenie63koszt26 ne 0.0}"/></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie64dochod26}" rendered="#{itempit.zlecenie64dochod26 ne 0.0}"/></p:column>
                                <p:column colspan="1"></p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie65zaliczka26}" rendered="#{itempit.zlecenie65zaliczka26 ne 0.0}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="8" style="text-align: right">zus społeczne p.95</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zus51pole95}"/></p:column>
                             </p:row>
                            <p:row>
                                <p:column colspan="8" style="text-align: right">zus społeczne p.96</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zus51pole96}"/></p:column>
                             </p:row>
                            <p:row>
                                <p:column colspan="8" style="text-align: right">zus społ. do 26l. p.97</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zus51pole97}"/></p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="8" style="text-align: right">zdrowotne potrącone p.122</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zus52pole122}"/></p:column>
<!--                                <p:column colspan="1" style="text-align: right">zdrow. do 26l. 80</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zus52pole80}"/></p:column>-->
                            </p:row>
                            <p:row>
                                <p:column colspan="3" style="text-align: right">suma zwolnione 109</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.przychody109sumado26lat}"  rendered="#{itempit.przychody109sumado26lat ne 0.0}"/></p:column>
                                <p:column colspan="1" style="text-align: right">w tym praca 110</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.praca110do26lat}" rendered="#{itempit.przychody109sumado26lat ne 0.0}"/></p:column>
                                <p:column colspan="1" style="text-align: right">w tym zlec 111</p:column>
                                <p:column colspan="1"><bcf:outputpl value="#{itempit.zlecenie111do26lat}" rendered="#{itempit.przychody109sumado26lat ne 0.0}"/></p:column>
                            </p:row>
                        </p:row>
                    </p:panelGrid>
                </p:column>
            </p:dataTable>
        </h:form>
    </p:outputPanel>
    </p:tab>
        <p:tab title="wystawione PIT-11">
            <p:outputPanel style="padding: 20px;">
                <h:outputText value="Nie widze karty! Nie można podpisać deklaracji" rendered="#{podpisView.jestkarta eq false}" style="color: red;"/>
            </p:outputPanel>
             <p:outputPanel>
            <h:form id="wystawionepit11">
            <p:dataTable id="datalistwa" value="#{kartaWynagrodzenView.listaPIT11}" var="itempity11"
                         rowKey="#{itempity11.id}" rowIndexVar="indexpity11" 
                         style="height: 450px; width: 1470px; overflow-y:scroll;" emptyMessage="Nie pobrano danych"
                         sortBy="#{itempity11.pracownik.nazwiskoImie}" 
                         >
                <f:facet name="header">
                    <h:outputText value="Wygegnerowane deklaracje PIT-11"/>
                </f:facet>
                <p:column width="20" style="text-align: center;">
                    <h:outputText value="#{indexpity11+1}"/>
                </p:column>
                <p:column width="50" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="rok"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.rok}"/>
                </p:column>
                <p:column width="70" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="nazwa"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.nazwa}"/>
                </p:column>
                <p:column width="120" style="text-align: left;" sortBy="#{itempity11.pracownik.nazwiskoImie}" sortOrder="asc">
                    <f:facet name="header">
                        <h:outputText value="pracownik"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.pracownik.nazwiskoImie}"/>
                </p:column>
                <p:column width="100" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="wysyłka"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.datawysylki}">
                        <f:convertDateTime timeStyle="short" type="both"/>
                    </h:outputText>
                </p:column>
                <p:column width="150" style="text-align: left;">
                    <f:facet name="header">
                        <h:outputText value="nr id"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.identyfikator}"/>
                </p:column>
                <p:column width="40" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="status"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.status}" rendered="#{itempity11.status ne '200'}"/>
                    <h:outputText value="#{itempity11.status}" rendered="#{itempity11.status eq '200'}" style="color: green;"/>
                </p:column>
                <p:column width="100" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="upo data"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.dataupo}">
                        <f:convertDateTime locale="pl"/>
                    </h:outputText>
                </p:column>
                <p:column width="300">
                    <f:facet name="header">
                        <h:outputText value="wersja"/>
                    </f:facet>
                    <h:outputText value="#{itempity11.klasa}"/>
                </p:column>
                 <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="pdf"/>
                    </f:facet>
                    <p:commandButton icon="pi pi-file-pdf" actionListener="#{kartaWynagrodzenView.drukujPIT11(itempity11, true)}">
                    </p:commandButton>
                </p:column>
                 <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="xml"/>
                    </f:facet>
                    <p:commandButton icon="pi pi-print" actionListener="#{kartaWynagrodzenView.pokazPIT11XML(itempity11)}">
                    </p:commandButton>
                </p:column>
                 <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="us"/>
                    </f:facet>
                     <p:commandButton icon="pi pi-envelope" actionListener="#{pitWysylkaView.robPIT1129(itempity11)}" update="akordeon:wystawionepit11:datalistwa"  rendered="#{podpisView.jestkarta eq true}">
                        <p:confirm type="popup" header="Potwierdzenie" message="Wysłać deklarację do urzędu?" icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                </p:column>
                 <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value="upo"/>
                    </f:facet>
                    <p:commandButton icon="pi pi-cloud-download" actionListener="#{pitWysylkaView.pobierztest(itempity11)}" update="akordeon:wystawionepit11:datalistwa">
                        <p:confirm type="popup" header="Potwierdzenie" message="Pobrać UPO?" icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                </p:column>
                <p:column width="30" style="text-align: center;">
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <p:commandButton icon="pi pi-trash" actionListener="#{kartaWynagrodzenView.usunPIT11(itempity11)}" update="akordeon:wystawionepit11 akordeon:KartyWynangrodzenPITForm">
                        <p:confirm type="popup" header="Potwierdzenie" message="Usunąć deklaracje?" icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
                <p:panelGrid columns="4" style="padding: 20px;">
                        <p:commandButton value="drukuj wszystkie" styleClass="buttonnorm" actionListener="#{kartaWynagrodzenView.drukujwszystkiePIT11()}" global="true"/>
                        <p:commandButton value="wyślij do urzędu" styleClass="buttonnorm" actionListener="#{pitWysylkaView.zbiorczawysylka(kartaWynagrodzenView.listaPIT11)}" global="true" update="akordeon:wystawionepit11">
                            <p:confirm type="popup" header="Potwierdzenie" message="Wysłać wszystko do US?" icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                        <p:commandButton value="pobierz UPO" styleClass="buttonnorm" actionListener="#{pitWysylkaView.pobierzUPO(kartaWynagrodzenView.listaPIT11)}" global="true" update="akordeon:wystawionepit11"/>
                        <p:commandButton value="mail do firmy" styleClass="buttonnorm" actionListener="#{kartaWynagrodzenView.mailwszystkie()}" global="true">
                            <p:confirm type="popup" header="Potwierdzenie" message="Wysłać PIT-y do firmy?" icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </p:panelGrid>
        </h:form>
    </p:outputPanel>
        </p:tab>
    </p:tabView>
</ui:composition>

