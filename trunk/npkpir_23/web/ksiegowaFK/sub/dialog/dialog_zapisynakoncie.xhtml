<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:pe="http://primefaces.org/ui/extensions"
    >

    <p:dialog id="zapisy" header="Zapisy na kontach" widgetVar="zapisynakoncie" 
              resizable="true" onShow="ustawdialog('zapisy','menuraporty',1250,750);" onHide="resetujdialog('zapisy');"  closeOnEscape="true" 
              >
        <p:layout fullPage="false" style="width: 1225px; min-height: 650px; max-height: 1000px;">  
            <p:layoutUnit position="north" >
                <h:form id="formwpiskonta">
                    <h:outputText value="wybierz konto: "/>
                    <p:autoComplete id="kontoma" value="#{kontoZapisFKView.wybranekonto}" completeMethod="#{kontoView.complete}"
                                    var="p" itemLabel="#{p.pelnynumer} #{p.nazwapelna}" itemValue="#{p}"
                                    minQueryLength="1" maxResults="15" maxlength="10" converter="KontoConv"
                                    global="false" converterMessage="Nieudana konwersja Klient"
                                    styleClass="kontoinput" 
                                    >
                        <p:ajax event="keyup"  listener="#{kontoZapisFKView.pobierzZapisyNaKoncie}" update=":form:dataList, :tabelazzapisami:tabela, :sumy"/>
                        <p:ajax event="blur"  listener="#{kontoZapisFKView.pobierzZapisyNaKoncie}" update=":form:dataList, :tabelazzapisami:tabela, :sumy"/>
                    </p:autoComplete>
                </h:form>
                <h:outputText value="#{kontoZapisFKView.zapisydopodswietlenia}" id="zapisydopodswietlenia" />
            </p:layoutUnit>  
           
            <p:layoutUnit position="west" size="340">
                 <p:panelGrid columns="2" >
                <p:commandButton id="rozwinwsz" value="rozwiń wszystkie" actionListener="#{planKontView.rozwinwszystkie()}" update=":form:dataList" style="float: left;" />
                <p:commandButton id="zwinwsz" value="zwiń wszystkie" actionListener="#{planKontView.zwinwszystkie()}" update=":form:dataList" style="float: left;" />
            </p:panelGrid>
                <h:form id="form">
                    <p:dataTable id="dataList" value="#{planKontView.wykazkont}" var="loop" rowIndexVar="row" selectionMode="single" selection="#{kontoZapisFKView.wybranekonto}" rowKey="#{loop.id}"
                                 sortBy="#{loop.pelnynumer}" >
                        <p:ajax event="rowSelect" update=":formwpiskonta:kontoma, :tabelazzapisami:tabela, :sumy" listener="#{kontoZapisFKView.pobierzZapisyNaKoncie}" />
                        <p:column>
                            <p:commandButton value="+" actionListener="#{planKontView.rozwinkonto(loop.pelnynumer)}" update=":form:dataList" rendered="#{(loop.rozwin eq false)and(loop.mapotomkow eq true)}" style="width: 25px; height: 25px;"/>
                            <p:commandButton value="-" actionListener="#{planKontView.zwinkonto(loop.pelnynumer)}" update=":form:dataList" rendered="#{(loop.rozwin eq true)and(loop.mapotomkow eq true)}" style="width: 25px; height: 25px;"/>
                            <p:commandButton value="" update=":form:dataList" rendered="#{loop.mapotomkow eq false}" style="width: 25px; height: 25px;"/>
                        </p:column>
                        <p:column headerText="nr konta" style="width: 180px;" styleClass="#{loop.analityka eq 2 ? 'druga' : null}">
                            <h:outputText value="#{loop.pelnynumer}" /> 
                        </p:column>
                        <p:column headerText="nazwa pełna" style="width: 250px;">
                            <h:outputText value="#{loop.nazwapelna}" /> 
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:layoutUnit>  
<!--            <p:layoutUnit position="east" size="200">  
            </p:layoutUnit>  -->
            <p:layoutUnit position="center">
                <h:form id="tabelazzapisami">  
                    <p:dataTable id="tabela" value="#{kontoZapisFKView.kontozapisy}" var="loop" rowKey="#{loop.wiersz.idwiersza}" 
                                 selection="#{kontoZapisFKView.wybranekontadosumowania}" style="width: 870px;" sortBy="#{loop.wiersz.idwiersza}" >
                        <p:ajax event="rowSelectCheckbox" update=":sumy" listener="#{kontoZapisFKView.sumazapisow}"/>
                        <p:ajax event="rowUnselectCheckbox" update=":sumy" listener="#{kontoZapisFKView.sumazapisow}"/>
                        <p:ajax event="toggleSelect" update=":sumy" listener="#{kontoZapisFKView.sumazapisow}"/>
                        <p:ajax event="rowSelect" update=":tabelazzapisami:tabela" listener="#{kontoZapisFKView.odszukajsparowanerozrachunki}"/>
                        <p:column selectionMode="multiple" width="35"></p:column>
                        <p:column headerText="id" width="40" sortBy="#{loop.id}" >
                            <h:outputText value="#{loop.id}"/>
                        </p:column>
                        <p:column headerText="id wiersza" width="40" sortBy="#{loop.wiersz.idwiersza}" >
                            <h:outputText value="#{loop.wiersz.idwiersza}"/>
                        </p:column>
                        <p:column headerText="data" width="70" sortBy="#{loop.wiersz.dataksiegowania}">
                             <h:outputText value="#{loop.wiersz.dataksiegowania}"/>
                        </p:column>
                        <p:column headerText="opis" sortBy="#{loop.opis}">
                            <h:outputText value="#{loop.opis}"/>
                        </p:column>
                        <p:column headerText="Wn" sortBy="#{loop.kwotawn}">
                             <h:outputText id="kwotawnwiersz" value="#{loop.kwotawn}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                        <p:column headerText="Ma" sortBy="#{loop.kwotama}">
                            <h:outputText id="kwotamawiersz" value="#{loop.kwotama}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                        </p:column>
                        <p:column headerText="Konto nr" sortBy="#{loop.konto}">
                             <h:outputText id="kontonr" value="#{loop.konto}"/>
                        </p:column>
                        <p:column headerText="Konto nazwa" sortBy="#{loop.kontoob.nazwapelna}">
                            <h:outputText value="#{loop.kontoob.nazwapelna}"/>
                        </p:column>
                        <p:column headerText="Konto przeciwstawne"  sortBy="#{loop.kontoprzeciwstawne}">
                            <h:outputText value="#{loop.kontoprzeciwstawne}"/>
                        </p:column>
                    </p:dataTable>
               </h:form>  
            </p:layoutUnit>  
            <p:layoutUnit position="south">  
                <p:panelGrid id="sumy" columns="8" style="float: right; width: 1000px;">
                    <h:outputText value="suma zapisów Wn"/><h:outputText value="#{kontoZapisFKView.sumaWn}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                    <h:outputText value="suma zapisów Ma"/><h:outputText value="#{kontoZapisFKView.sumaMa}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                    <h:outputText value="saldo zapisów Wn"/><h:outputText value="#{kontoZapisFKView.saldoWn}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                    <h:outputText value="saldo zapisów Ma"/><h:outputText value="#{kontoZapisFKView.saldoMa}" style="float: right;">
                                <f:convertNumber minFractionDigits="2" locale="PL"/>
                             </h:outputText>
                </p:panelGrid>
            </p:layoutUnit>  
        </p:layout>  
    </p:dialog>
</ui:composition>

