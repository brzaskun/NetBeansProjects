<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:pe="http://primefaces.org/ui/extensions"
    >
    <style>
        .ui-inputfield .ui-inputtext {
            padding: 0px !important;
            margin: 0px !important;
        }

        .ui-datatable-data tr td {
            padding: 0px !important;
            margin: 0px !important;
        }
/*        dzieki temu nie mamy ramek przy wpisywani danych do dokumentu*/
        .ui-inputfield, .ui-widget-content .ui-inputfield, .ui-widget-header .ui-inputfield {
            border: none;
            outline: none;
            box-shadow: none;
            padding: 0px;
        }
        .ui-inputfield.ui-state-focus, .ui-widget-content .ui-inputfield.ui-state-focus, .ui-widget-header .ui-inputfield.ui-state-focus {
            -webkit-box-shadow: none;
            box-shadow: none;
            font-weight: 900;
            background: #e4e3e3;
        }
        
        
    </style>
    <p:dialog id="dialogpierwszy" header="Dane wprowadzanego dokumentu. Podatnik: #{WpisView.podatnikWpisu}" widgetVar="wpisywanie" 
              resizable="false" onShow="wpisywanieOnShow();" closable="false" onHide="wpisywanieOnHide();">
        <p:ajax event="close" listener="#{dokfkView.resetujDokument()}" update=":formwpisdokument "/>
        <h:form id="formwpisdokument">
            <div style="height: 100px;">
                <!--                nagłówek dokumentu-->
                <p:panelGrid id="paneldaneogolnefaktury" columns="5">
                    <h:outputText value="data"/>
                    <h:outputText value="symbol"/>
                    <h:outputText value="numer"/>
                    <h:outputText value="rok"/>
                    <h:outputText value="miesiąc"/>
                    <h:inputText id="dataDialogWpisywanie" value="#{dokfkView.selected.datawystawienia}" 
                                 onblur="ustawDateFK(#{WpisView.rokWpisu}, #{WpisView.miesiacWpisu});$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');"
                                 title="wpisz numer dnia, lub miesiąc i dzień"
                                 styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all"
                                 onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                 >
                        <p:ajax event="blur" listener="#{dokfkView.wygenerujokreswpisudokumentu}" />
                    </h:inputText>
                    <h:selectOneMenu id="symbol" value="#{dokfkView.selected.dokfkPK.seriadokfk}" styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all"
                                     onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                     onblur="$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');">
                        <f:selectItem itemLabel="FVS" itemValue="FVS"/>
                        <f:selectItem itemLabel="WB" itemValue="WB"/>
                        <f:selectItem itemLabel="BO" itemValue="BO"/>
                        <f:ajax event="blur" execute="@this"/>
                        <f:ajax event="blur" execute=":formwpisdokument:numer" listener="#{dokfkView.przygotujDokumentWpisywanie()}"/>
                    </h:selectOneMenu>
                    <h:inputText id="numer" value="#{dokfkView.selected.dokfkPK.nrkolejnywserii}"
                                 styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all"
                                     onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                     onblur="$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');">
                        <f:ajax event="blur" execute="@this"/>
                    </h:inputText>
                    <h:selectOneMenu id="rok" value="#{dokfkView.selected.dokfkPK.rok}" style="width: 200px;"
                                     styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all"
                                     onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                     onblur="$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');"
                                     >
                        <f:selectItems value="#{Roki.rokiList}"/>
                        <f:ajax event="blur" execute="@this" listener="#{dokfkView.znajdzduplicatdokumentu}"/></h:selectOneMenu>
                    <h:selectOneMenu id="miesiac" value="#{dokfkView.selected.miesiac}"
                                     styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all"
                                     onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                     onblur="$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');">
                        <f:selectItems value="#{Mce.mceList}"/>
                        <f:ajax event="blur" execute="@this"/>
                    </h:selectOneMenu>
                </p:panelGrid>
                <p:panelGrid columns="3">
                    <h:outputText value="numer własny"/>
                    <h:outputText value="treść dok."/>
                    <h:outputText value="wartość dokumentu"/>
                    <h:inputText id="numerwlasny" value="#{dokfkView.selected.numerwlasnydokfk}" 
                                 styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all"
                                 onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                 onblur="$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');">
                        <f:ajax event="blur" execute="@this"/>
                    </h:inputText>
                    <h:inputText value="#{dokfkView.selected.opisdokfk}" size="80"
                                 styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all"
                                     onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                     onblur="$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');"
                                 >
                        <f:ajax />
                    </h:inputText>
                    <h:outputText id="wartoscdokumentu"  value="#{dokfkView.selected.wartoscdokumentu}" style="float: right;">
                            <f:convertNumber minFractionDigits="2" locale="PL"/>
                 </h:outputText>
                </p:panelGrid>
            </div>
            <p:panelGrid columns="2">
                <p:panelGrid  columns="1" style="width: 200px;">
                        <h:outputText value="waluta dokumentu" rendered="#{!dokfkView.selected.zablokujzmianewaluty}"/>
                        <h:selectOneMenu id="wybranawaluta" value="#{dokfkView.selected.walutadokumentu}" valueChangeListener="#{dokfkView.pobierzkursNBP}" 
                                         readonly="#{dokfkView.selected.zablokujzmianewaluty}" rendered="#{!dokfkView.selected.zablokujzmianewaluty}"
                                         styleClass="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all" converter="WalutyConv"
                                        onfocus="$(this).removeClass('ui-state-default');$(this).addClass('ui-state-focus');"
                                        onblur="$(this).removeClass('ui-state-focus');$(this).addClass('ui-state-default');" 
                                         >
                            <f:ajax />
                            <f:selectItems value="#{dokfkView.wprowadzonesymbolewalut}" var="p" itemLabel="#{p.symbolwaluty}" itemValue="#{p}"/>
                        </h:selectOneMenu>
                </p:panelGrid>
                <p:panelGrid  columns="3" style="width: 600px;" id="panelwalutowy" >
                    <h:outputText id="w02" value="#{dokfkView.selected.walutadokumentu eq 'PLN' ? ''  : 'z dnia'}" rendered="#{dokfkView.pokazRzadWalutowy}"/>
                        <h:outputText id="w01" value="#{dokfkView.selected.walutadokumentu eq 'PLN' ? ''  : 'tabela NBP'}" rendered="#{dokfkView.pokazRzadWalutowy}"/>
                        <h:outputText id="w03" value="#{dokfkView.selected.walutadokumentu eq 'PLN' ? ''  : 'kurs średni'}" rendered="#{dokfkView.pokazRzadWalutowy}"/>
                        <h:outputText id="w11" value="#{dokfkView.selected.walutadokumentu eq 'PLN' ? ''  : dokfkView.selected.tabelanbp.datatabeli}" rendered="#{dokfkView.pokazRzadWalutowy}"/>
                        <h:outputText id="w12" value="#{dokfkView.selected.walutadokumentu eq 'PLN' ? ''  : dokfkView.selected.tabelanbp.nrtabeli}" rendered="#{dokfkView.pokazRzadWalutowy}"/>
                        <h:outputText id="w13" value="#{dokfkView.selected.walutadokumentu eq 'PLN' ? ''  : dokfkView.selected.tabelanbp.kurssredni}" rendered="#{dokfkView.pokazRzadWalutowy}"/>
                </p:panelGrid>
            </p:panelGrid>
            <div style="height: 450px;">
                <!--                poszczególne wiersze-->
                <p:dataTable id="dataList" value="#{dokfkView.selected.listawierszy}" var="loop" style="width: 1220px; max-height: 440px;" scrollable="true"
                             rowIndexVar="rowindex">
                    <p:column headerText="lp" width="20" style="text-align: center">
                        <h:outputText value="#{loop.idporzadkowy}" />
                    </p:column>
                    <p:column headerText="opis transakcji" width="250" style="text-align: center;">
                        <p:inputText id="opis" value="#{loop.opisWiersza}" style="width: 240px;" onkeypress="wywolajdok('#{planKontJSView.opiskonta}', '#{planKontJSView.pelnynumerkonta}', '#{loop.idporzadkowy}');" onblur="skopiujopis(#{loop.idporzadkowy});" styleClass="kasa">
                            <f:ajax event="blur" execute="@this"/>
                        </p:inputText>
                    </p:column>
                    <p:column headerText="data" width="50" style="text-align: center;"  rendered="#{dokfkView.pokazPanelWalutowy}" >
                        <p:spinner id="minmax" min="1" max="31" stepFactor="1" size="2" value="#{loop.dataWalutyWiersza}" style="padding-right: 20px;">
                            <f:ajax event="keyup" execute="@this"/>
                            <f:ajax event="blur" listener="#{dokfkView.pobierzkursNBPwiersz(loop.dataWalutyWiersza, loop)}"/>
                        </p:spinner>
                    </p:column>
                    <p:column headerText="kwota"  style="text-align: center;" width="120">
                        <pe:inputNumber id="wn" value="#{loop.stronaWn.kwota}" style="text-align: right; margin-left: auto; margin-right: auto;" rendered="#{loop.stronaWn != null}"
                                        symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="kasa">
                            <f:ajax event="blur" execute="@this"/>
                        </pe:inputNumber>
                    </p:column>
                    <p:column width="12" style="text-align: center" >
                        <h:outputText id="symbolWn" value="${loop.tabelanbp.waluta.skrotsymbolu}" rendered="#{loop.stronaWn != null}"/>
                    </p:column>

                    <p:column headerText="konto Wn" width="200" style="text-align: center;"> 
                        <p:autoComplete id="kontown" value="#{loop.stronaWn.konto}" completeMethod="#{planKontView.complete}" rendered="#{loop.stronaWn != null}"
                                        var="p" itemLabel="#{p.pelnynumer} #{p.nazwapelna}" itemValue="#{p}"
                                        minQueryLength="1" converter="KontoConv" cache="true" forceSelection="true" queryDelay="10" queryDeletionDelay="10"
                                        converterMessage="Nieudana konwersja Klient" style="margin-left: auto; margin-right: auto;"
                                        styleClass="kontoinput" onfocus="zachowajwiersz(#{loop.idporzadkowy}, 'Wn');" 
                                        ><!--to teraz powoduje blad-->
                            <p:ajax event="blur" listener="#{dokfkView.skopiujKontoZWierszaWyzej(rowindex, 'Wn')}" partialSubmit="true" update="@this"/>
                        </p:autoComplete>
                    </p:column>
                    <p:column headerText="kwota" style="text-align: center;" width="120">
                        <pe:inputNumber id="ma" value="#{loop.stronaMa.kwota}" style="text-align: right; margin-left: auto; margin-right: auto;" rendered="#{loop.stronaMa != null}"
                                        symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="kasa">
                            <p:ajax event="blur" partialSubmit="true" listener="#{dokfkView.skopiujWndoMa(loop)}" update="@this"/>
                            <!--onstart="sprawdzwartosc({loop.idporzadkowy});" -->
                        </pe:inputNumber> 
                    </p:column>
                    <p:column width="12" style="text-align: center" >
                        <h:outputText id="symbolMa" value="${loop.tabelanbp.waluta.skrotsymbolu}" rendered="#{loop.stronaMa != null}"/>
                    </p:column>
                    <p:column headerText="konto Ma" width="200" style="text-align: center;">
                        <p:autoComplete id="kontoma" value="#{loop.stronaMa.konto}" completeMethod="#{planKontView.complete}" rendered="#{loop.stronaMa != null}"
                                        var="p" itemLabel="#{p.pelnynumer} #{p.nazwapelna}" itemValue="#{p}"
                                        minQueryLength="1" converter="KontoConv" cache="true" forceSelection="true" queryDelay="10" queryDeletionDelay="10"
                                        converterMessage="Nieudana konwersja Klient"  style="margin-left: auto; margin-right: auto;"
                                        styleClass="kontoinput" onfocus="zachowajwiersz(#{loop.idporzadkowy}, 'Ma');" 
                                        >
<!--ARCHEO                  <p:ajax event="itemSelect" listener="{dokfkView.handleKontoSelect}" partialSubmit="true"/>-->
                            <p:ajax event="blur" listener="#{dokfkView.skopiujKontoZWierszaWyzej(rowindex, 'Ma')}" partialSubmit="true" update="@this"/>
                            <f:ajax event="blur" onevent="sprawdzpoprzedniwiersz(#{loop.idporzadkowy})"/>
                        </p:autoComplete>
                    </p:column>
                    <p:column  width="40" style="text-align: left;">
                        <p:commandButton id="dodajwierszbutton"  value="+" style=" margin-left: 10px; height: 20px;" actionListener="#{dokfkView.dolaczNowyWiersz(rowindex)}" update="@form, :wpisywaniefooter, :formwpisdokument:wartoscdokumentu" accesskey="p" oncomplete="obsluzwiersz(#{loop.idporzadkowy});" rendered="#{dokfkView.liczbawierszyWDokumencie gt loop.idporzadkowy ? false : true}"/>
                    </p:column>
                    <p:column width="3" >
                        <h:outputText id="wnNowaTransakcja" value="#{loop.stronaWn.typStronaWiersza}" />
                    </p:column>
                    <p:column  width="3">
                        <h:outputText id="maNowaTransakcja" value="#{loop.stronaMa.typStronaWiersza}" />
                    </p:column>
                </p:dataTable>
                <p:panel>
                    <p:commandButton id="wpiszdokbutton" value="#{mgs.zapisz} (s)" styleClass="fkbutton" style="width: 150px;" actionListener="#{dokfkView.dodaj}" 
                                     accesskey="s" update=":wpisywaniefooter, :formwpisdokument, :zestawieniedokumentow:dataList, :zestawieniezapisownakontach" 
                                     onsuccess="powrocNaPoczatekDokfk();" rendered="#{!dokfkView.zapisz0edytuj1}"
                                     onfocus="sprawdzpoprzedniwiersz(#{dokfkView.selected.listawierszy.size()})"/>
                    <p:commandButton id="edytujdokbutton" value="#{mgs.edytuj} (w)" styleClass="fkbutton" style="width: 150px;" actionListener="#{dokfkView.edycja}" 
                                     accesskey="w" update=":wpisywaniefooter, :zestawieniedokumentow:dataList, :zestawieniezapisownakontach" 
                                     oncomplete="PF('wpisywanie').hide();" rendered="#{dokfkView.zapisz0edytuj1}"/>

                </p:panel>
            </div>
        </h:form>
        <f:facet name="footer">
            <h:form id="wpisywaniefooter">
                <p:commandButton value="#{mgs.usun}" actionListener="#{dokfkView.usunWierszWDokumencie}" styleClass="fkbutton" style="width: 150px;" accesskey="u" update=":formwpisdokument:dataList" oncomplete="aktualizujmape(#{dokfkView.liczbawierszyWDokumencie});"/>
                <p:commandButton value="#{mgs.rozrachunki}" styleClass="fkbutton" style="width: 150px; margin-left: 10px;" actionListener="#{dokfkView.tworzenieTransakcjiZWierszy()}" accesskey="r" />
                <p:commandButton id="zakmnijwpis" value="rezygnuj" styleClass="fkbutton" style="width: 150px; float: right;" actionListener="#{dokfkView.resetujDokument}" update=":wpisywaniefooter, :formwpisdokument"  onclick="zamykanieDialogow();" rendered="#{!dokfkView.zablokujprzyciskrezygnuj}"/>
                <p:commandButton id="przywrocwpisbutton" value="przywrocwpisbutton" actionListener="#{dokfkView.przywrocwpisbutton}" update=":formwpisdokument" style="display: none;"/>
                <h:inputText id="wierszid" value="#{dokfkView.numerwiersza}" style="display: none;"/>
                <h:inputText id="wnlubma" value="#{dokfkView.stronawiersza}" style="display: none;"/>
            </h:form>
        </f:facet>

    </p:dialog>

</ui:composition>
