<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:pe="http://primefaces.org/ui/extensions"
    >

    <p:dialog id="dialogpierwszy" header="Dane faktury" widgetVar="pierwszy" 
              resizable="false" onShow="pierwszyonShow();" closable="false" onHide="pierwszyOnHide();">
        <p:ajax event="close" listener="#{dokfkView.resetujDokument()}" update=":formwpisdokument "/>

        <h:form id="formwpisdokument">
            <div style="height: 100px;">
                <!--                nagłówek dokumentu-->
                <p:panelGrid columns="12">
                    <h:outputText value="data"/><p:inputText id="datka" value="#{dokfkView.selected.datawystawienia}"  onblur="ustawDateFK(2013, 11);" title="wpisz numer dnia, lub miesiąc i dzień">
                        <f:ajax event="blur" execute="@this" listener="#{dokfkView.wygenerujokreswpisudokumentu}"/>
                    </p:inputText>
                    <h:outputText value="symbol"/><h:selectOneMenu id="symbol" value="#{dokfkView.selected.dokfkPK.seriadokfk}">
                        <f:selectItem itemLabel="FVS" itemValue="FVS"/>
                        <f:ajax event="blur" execute="@this"/>
                        <f:ajax event="blur" execute=":formwpisdokument:numer" listener="#{dokfkView.pobierzostatninumerdok}"/>
                    </h:selectOneMenu>
                    <h:outputText value="numer"/><h:inputText id="numer" value="#{dokfkView.selected.dokfkPK.nrkolejny}">
                        <f:ajax event="blur" execute="@this"/>
                    </h:inputText>
                    <h:outputText value="podatnik"/><h:selectOneMenu id="podatnik" value="#{dokfkView.selected.dokfkPK.podatnik}" style="width: 200px;">
                        <f:selectItem itemLabel="Kowalski" itemValue="Kowalski"/>
                        <f:ajax event="blur" execute="@this"/></h:selectOneMenu>
                    <h:outputText value="rok"/><h:selectOneMenu id="rok" value="#{dokfkView.selected.dokfkPK.rok}" style="width: 200px;">
                        <f:selectItem itemLabel="2013" itemValue="2013"/>
                        <f:ajax event="blur" execute="@this" listener="#{dokfkView.znajdzduplicatdokumentu}"/></h:selectOneMenu>
                    <h:outputText value="miesiąc"/><h:selectOneMenu id="miesiac" value="#{dokfkView.selected.miesiac}">
                        <f:selectItems value="#{Mce.mceList}"/>
                        <f:ajax event="blur" execute="@this"/></h:selectOneMenu>
                     </p:panelGrid>
                <p:panelGrid columns="2">
                    <h:outputText value="treść dok."/><h:inputText value="#{dokfkView.selected.tresc}" size="80">
                        <f:ajax event="blur" execute="@this"/>
                    </h:inputText>
                </p:panelGrid>
            </div>
            <div style="height: 70px;">
                <p:panelGrid columns="7" style="width: 800px;">
                    <h:selectOneMenu id="wybranawaluta" value="#{dokfkView.selected.walutadokumentu}" valueChangeListener="#{dokfkView.pobierzkursNBP}">
                        <f:ajax event="blur" execute="@this"/>
                        <f:selectItem itemValue="PLN" itemLabel="PLN"/>
                        <f:selectItems value="#{dokfkView.wprowadzonesymbolewalut}"/>
                    </h:selectOneMenu>
                    <h:outputText value="tabela NBP"/><h:outputText id="w11" value="#{dokfkView.selected.tabelanbp.tabelanbpPK.nrtabeli}"/>
                    <h:outputText value="z dnia"/><h:outputText id="w12" value="#{dokfkView.selected.tabelanbp.datatabeli}"/>
                    <h:outputText value="kurs średni"/><h:outputText id="w13" value="#{dokfkView.selected.tabelanbp.kurssredni}"/>
                </p:panelGrid>
               
            </div>
            <div style="height: 430px;">
                <!--                poszczególne wiersze-->
                <p:dataTable id="dataList" value="#{dokfkView.selected.konta}" var="loop" style="width: 1260px; max-height: 370px;" scrollable="true" 
                             >
                    <p:column headerText="id" width="15">
                        <h:outputText value="#{loop.idporzadkowy}" />
                    </p:column>
                    <p:column headerText="opis transakcji" width="170">
                        <p:inputText id="opis" value="#{loop.opis}" style="width: 170px;" onkeypress="wywolajdok('#{planKontView.opiskonta}', '#{planKontView.pelnynumerkonta}', '#{loop.idporzadkowy}');" onblur="skopiujopis(#{loop.idporzadkowy});" styleClass="kasa">
                            <f:ajax event="blur" listener="#{dokfkView.dodajdanedowiersza}"  execute="@this"/>
                            <f:ajax event="focus" listener="#{dokfkView.pobierzsymbolwaluty()}" />
                        </p:inputText>
                    </p:column>
                    <p:column headerText="kwota"  width="125">
                        <pe:inputNumber id="wn" value="#{loop.wierszStronaWn.kwota}" style="text-align: right;" symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="kasa">
                            <f:ajax event="blur" execute="@this"/>
                        </pe:inputNumber>
                    </p:column>
                    <p:column width="7">
                        <h:outputText id="symbolWn" value="#{dokfkView.symbolwalutydowiersza}"/>
                    </p:column>
                    <p:column headerText="konto Wn" width="190" >
                        <p:autoComplete id="kontown" value="#{loop.wierszStronaWn.konto}" completeMethod="#{planKontView.complete}"
                                        var="p" itemLabel="#{p.pelnynumer} #{p.nazwapelna}" itemValue="#{p}"
                                        minQueryLength="1" maxResults="15" maxlength="10" converter="KontoConv"
                                        global="false" converterMessage="Nieudana konwersja Klient" 
                                        required="true" requiredMessage="Pole konta Wn nie może byc puste" styleClass="kontoinput" onfocus="zachowajwiersz(#{loop.idporzadkowy}, 'Wn');"
                                        ><!--to teraz powoduje blad-->
                            <f:ajax event="blur" execute="@this" />
                        </p:autoComplete>
                    </p:column>
                    <p:column headerText="kwota"  width="125">
                        <pe:inputNumber id="ma" value="#{loop.wierszStronaMa.kwota}" style="text-align: right;" symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="kasa" >
                            <f:ajax event="blur" execute="@this"/>
                        </pe:inputNumber>
                    </p:column>
                    <p:column width="7">
                        <h:outputText id="symbolMa" value="#{dokfkView.symbolwalutydowiersza}"/>
                    </p:column>
                    <p:column headerText="konto Ma" width="190">
                        <p:autoComplete id="kontoma" value="#{loop.wierszStronaMa.konto}" completeMethod="#{planKontView.complete}"
                                        var="p" itemLabel="#{p.pelnynumer} #{p.nazwapelna}" itemValue="#{p}"
                                        minQueryLength="1" maxResults="15" maxlength="10" converter="KontoConv"
                                        global="false" converterMessage="Nieudana konwersja Klient" style="margin-left: auto; margin-right: auto;"
                                        required="true" requiredMessage="Pole konta Ma nie może byc puste" styleClass="kontoinput" onfocus="sprawdzwartosc(#{loop.idporzadkowy});
                            zachowajwiersz(#{loop.idporzadkowy}, 'Ma');"
                                        >
                            <f:ajax event="blur" execute="@this" onevent="sprawdzpoprzedniwiersz(#{loop.idporzadkowy})"/>
                        </p:autoComplete>
                    </p:column>
                    <p:column  width="50">
                        <p:commandButton id="dodajwierszbutton" value="+" actionListener="#{dokfkView.liczbaw}" update="@form" accesskey="p" oncomplete="obsluzwiersz(#{loop.idporzadkowy});" rendered="#{dokfkView.liczbawierszy gt loop.idporzadkowy ? false : true}"/>
                    </p:column>
                </p:dataTable>
                <p:panel>
                    <p:commandButton id="wpiszdokbutton" value="#{mgs.zapisz}" styleClass="fkbutton" actionListener="#{dokfkView.dodaj}" accesskey="s" update=":formwpisdokument, :zestawieniedokumentow:dataList"  oncomplete="chowanienapoczatekdok();$('#formwpisdokument\\:datka').focus();" rendered="#{!dokfkView.zapisz0edytuj1}"/>
                    <p:commandButton id="edytujdokbutton" value="#{mgs.edytuj}" styleClass="fkbutton" actionListener="#{dokfkView.edycja}" update=":wpisywaniefooter"  rendered="#{dokfkView.zapisz0edytuj1}"/>

                </p:panel>
            </div>
        </h:form>
        <f:facet name="footer">
            <h:form id="wpisywaniefooter">
                <p:commandButton value="#{mgs.usun}" actionListener="#{dokfkView.liczbawu}" styleClass="fkbutton" accesskey="u" update=":formwpisdokument:dataList" oncomplete="aktualizujmape();"/>
                <p:commandButton value="#{mgs.rozrachunki}" styleClass="fkbutton" actionListener="#{dokfkView.rozrachunki}" accesskey="r" update=":rozrachunki"/>
                <p:commandButton id="zakmnijwpis" value="rezygnuj" styleClass="fkbutton" style="float: right;" update=":wpisywaniefooter"  onclick="pierwszy.hide()"/>
                <p:commandButton id="przywrocwpisbutton" value="przywrocwpisbutton" actionListener="#{dokfkView.przywrocwpisbutton}" update=":formwpisdokument" style="display: none;"/>
                <h:inputText id="wierszid" value="#{dokfkView.wierszid}" style="display: none;"/>
                <h:inputText id="wnlubma" value="#{dokfkView.wnlubma}" style="display: none;"/>
            </h:form>
        </f:facet>

    </p:dialog>

</ui:composition>
