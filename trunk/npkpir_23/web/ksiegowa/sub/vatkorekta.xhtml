<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:pe="http://primefaces.org/ui/extensions"
    >

    <h:form id="formX">
        <p:growl id="msg" autoUpdate="true"/>
        <p:panel header="Wykaz wysłanych deklaracji"/>
        <p:dataTable value="#{vatKorektaView.deklaracjeWyslane}" var="item" sortBy="#{item.miesiac}" rowIndexVar="row"
                     id="dokumentyLista" emptyMessage="brak deklaracji do wyslania" selection="#{vatKorektaView.deklaracjaVAT}"
                     paginator="true" paginatorAlwaysVisible="true" rows="1" rowKey="#{item.id}"
                     paginatorTemplate="{FirstPageLink} {PageLinks} {LastPageLink} {RowsPerPageDropdown}" 
                     rowsPerPageTemplate="1, 6,12,18,24,32,50" sortOrder="descending"
                     >
            <p:ajax event="rowSelectRadio" listener="#{vatKorektaView.wybranoDeklaracje}"/>
            <p:column selectionMode="single"/>
            <p:column style="width: 3%;">
                <p:rowToggler/>
            </p:column>
            <p:ajax event="rowEdit" update=":formX:msg" listener="#{deklaracjevatView.edit}" />
            <p:column headerText="wersja" width="60">
                <h:outputText value="#{item.wzorschemy}"/>
            </p:column>
            <p:column headerText="dane">
                <p:dataGrid columns="1" value="#{item.selected}" var="loop">
                    <h:panelGrid columns="4">
                        <h:outputText value="rodzaj deklaracji"/><h:outputText value="#{loop.rodzajdeklaracji}" style="font-weight: 900;"/>
                        <h:outputText value="podatnik"/><h:outputText value="#{item.podatnik}" style="font-weight: 900;"/>
                        <h:outputText value="miesięczna/kwartalna"/><h:outputText value="#{item.miesiackwartal eq false ? 'miesięczna' : 'kwartalna'}" style="font-weight: 900;"/>
                        <h:outputText value="okres rozliczeniowy"/><h:outputText value="#{item.rok}#{item.rok != null ? '/' : null}#{item.miesiac}" style="font-weight: 900;"/>
                        <h:outputText value="pierw./kor."/><h:outputText value="#{loop.celzlozenia eq 1 ? 'pierwotna' : 'korekta'}" style="font-weight: 900;"/>
                        <h:outputText value="nazwa urzędu"/><h:outputText value="#{loop.nazwaurzedu}"/>
                        <h:outputText value="status"/><h:outputText value="#{item.status}"/>
                        <h:outputText value="opis"/><h:outputText value="#{item.opis}"/>
                        <h:outputText value="data wysyłki"/><h:outputText value="#{item.datazlozenia}"/>
                        <h:outputText value="data potwierdzenia"/><h:outputText value="#{item.dataupo}"/>
                    </h:panelGrid>
                    <h:panelGrid columns="4">
                        <h:outputText value="należny (p.46)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI46}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="naliczony (p.55)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI55}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="przeniesienie (p.47)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI47}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="do zapłaty (p.58)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI58}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="do zwrotu(p.60)"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI60}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="na rachunek bankowy 25 dni"/><h:outputText value="#{loop.pozycjeszczegolowe.poleI62}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                        <h:outputText value="kwota autoryzacyjna"/><h:outputText value="#{loop.kwotaautoryzacja}" style="float: right;">
                            <f:convertNumber minFractionDigits="0" locale="PL"/></h:outputText>
                    </h:panelGrid>
                </p:dataGrid>
            </p:column>
            <p:column id="previewColumn" headerText="operacje" width="70">
                <p:panelGrid columns="1">
                    <p:commandButton value="Pdf" actionListener="#{pdfVAT7.drukuj(item, row)}"  style="margin-left: 10px; width: 80px;"/>
                </p:panelGrid>
            </p:column>
            <p:rowExpansion>
                <p:column id="ewidencjavat" headerText="treść wysyłki" width="300" resizable="true">
                    <h:outputText value="#{item.deklaracja}"/>
                </p:column>
            </p:rowExpansion>
        </p:dataTable>
    </h:form>

    <h:form id="wprowadzDokument">
        <p:panel header="Dane dokumentu korekty" style="padding: 1%;">
        <p:focus for="polawprowadzania">
            <p:panelGrid id="polawprowadzania" columns="4" style="width: 70%;">
                <h:outputLabel value="rodzaj dokumentu" style="font-weight: 700"/>
                <h:outputLabel value="nip/nazwa kontrahenta" style="font-weight: 700"/>
                <h:outputLabel value="nr własny" style="font-weight: 700;"/>
                <h:outputLabel value="opis transakcji" style="font-weight: 700"/>
                <h:selectOneMenu id="rodzajTrans" value="#{vatKorektaView.vatKorektaDok.symbolDokumentu}" required="true" title="wybierz rodzaj księgowanego dokumentu" valueChangeListener="#{DokumentView.wybranydokument}"
                                 style="width: 250px; word-break: break-all;">
                    <f:selectItems value="#{vatKorektaView.rodzajedokKlienta}" var="loop" itemLabel="#{loop.skrot} - #{loop.nazwa}" itemValue="#{loop.skrot}"/>
                    <p:ajax event="blur" partialSubmit="true" listener="#{vatKorektaView.podepnijEwidencjeVat()}" global="false" update="@form:tablicavat"/>
                </h:selectOneMenu> 
                <p:inputText id="nipkontrahenta" value="#{vatKorektaView.vatKorektaDok.nipKontrahenta}" title="wpisz nip kontrahenta" style="width: 200px;">
                    <f:validateLength minimum="1" maximum="50"/>
                </p:inputText>
                <p:inputText id="numerwlasny" value="#{vatKorektaView.vatKorektaDok.nrwłasny}" title="wpisz numer własny faktury" style="width: 200px;">
                    <f:validateLength minimum="1" maximum="50"/>
                </p:inputText>

                <p:autoComplete id="opis" value="#{vatKorektaView.vatKorektaDok.opisDokumnetu}" completeMethod="#{Opis.complete}"
                                var="p" itemLabel="#{p}" itemValue="#{p}"  title="wpisz opis faktury"
                                minQueryLength="2" maxResults="10" maxlength="40"
                                effect="clip" autocomplete="true"  queryDelay="1" style="width: 250px;">
                    <p:ajax event="change" partialSubmit="true" global="false"/>
                </p:autoComplete>
            </p:panelGrid>
            <p:dataTable id="tablicavat" value="#{vatKorektaView.vatKorektaDok.ewidencjaVAT}" var="item" emptyMessage="nie ma zapisów w ewidencji vat" style="width: 70%;"
                         rowIndexVar="row">
                <p:column headerText="rodzaj ewidencji" style="width: 25%;">
                    <h:outputText value="#{item.opis}"/>
                </p:column>
                <p:column headerText="netto" style="width: 20%;">
                    <pe:inputNumber id="netto" value="#{item.netto}" symbol=" zł" required="true" requiredMessage="Brak kwoty - uzupełnij" style="text-align: right;" symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="wiersznetto"> 
                        <p:ajax event="change" listener="#{vatKorektaView.wyliczbrutto(item)}" />
                    </pe:inputNumber>
                </p:column>
                <p:column headerText="vat" style="width: 20%;">
                    <pe:inputNumber id="vat" value="#{item.vat}" symbol=" zł" required="true" requiredMessage="Brak kwoty - uzupełnij" style="text-align: right;" symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="wiersznetto"> 
                        <p:ajax event="change" listener="#{vatKorektaView.wyliczbrutto(item)}" />
                    </pe:inputNumber>
                </p:column>
                <p:column headerText="brutto" style="width: 20%;">
                    <pe:inputNumber id="brutto" value="#{item.brutto}" symbol=" zł" required="true" requiredMessage="Brak kwoty - uzupełnij" style="text-align: right;" symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000" styleClass="wiersznetto"/>
                </p:column>
                <p:column headerText="op/zw" style="width: 15%;">
                    <h:selectOneMenu value="#{item.opzw}">
                        <f:selectItem itemLabel="sprz.op" itemValue="sprz.op"/>
                        <f:selectItem itemLabel="sprzed.op.izw." itemValue="sprzed.op.izw."/>
                    </h:selectOneMenu>
                </p:column>
            </p:dataTable>
            <p:commandButton value="dodaj" actionListener="#{vatKorektaView.dodajDok()}"/>
        </p:focus>
        </p:panel>
    </h:form>
</ui:composition>   


