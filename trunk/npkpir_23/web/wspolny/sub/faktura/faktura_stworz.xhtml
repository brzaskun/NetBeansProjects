<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:ft="http://primefaces.prime.com.tr/facestrace"
    xmlns:pe="http://primefaces.org/ui/extensions">
    <p:tab id="nowa" title="Sporządź nową fakturę" >
        <h:form id="formprzygotuj">
            <p:outputPanel style="padding: 5px;">
                <p:commandButton id="przygotuj" value="przygotuj fakture" actionListener="#{fakturaView.przygotujfakture()}" oncomplete="aktywujpolewyboruklientanafakturze();" update=":akordeon:formstworz" style="margin-bottom: 25px; margin-top: 10px" />
            </p:outputPanel>
        </h:form>
        <h:form id="formstworz">
            <p:outputPanel id="panelfaktury"  rendered="#{fakturaView.pokazfakture ? true : false}">
                <p:panelGrid columns="4" style="height: 250px;">
                    <h:outputLabel value="miejsce wystawienia faktury: " />
                    <p:inplace id="miejsce" editor="true" saveLabel="zachowaj wprowadzoną wartość" cancelLabel="wycofaj wprowadzone zmiany">  
                        <p:inputText value="#{fakturaView.selected.miejscewystawienia}" required="true" label="text" style="font-weight: bolder;"/>  
                    </p:inplace>
                    <h:outputLabel value="data wystawienia faktury: " />
                    <p:inputText value="#{fakturaView.selected.datawystawienia}" required="true" label="text" style="font-weight: bolder;"/>  
                    <h:outputLabel value="data, albo miesiąc i rok dokonania czynności: " />
                    <p:inputText value="#{fakturaView.selected.datasprzedazy}" required="true" label="text" style="font-weight: bolder;"/>  
                    <h:outputLabel value="nr faktury: "/>
                    <p:inplace id="nrfaktury" editor="true" saveLabel="zachowaj wprowadzoną wartość" cancelLabel="wycofaj wprowadzone zmiany">  
                        <p:inputText value="#{fakturaView.selected.fakturaPK.numerkolejny}" required="true" label="text" style="font-weight: bolder;"/>  
                    </p:inplace>
                    <h:outputLabel value="termin zapłaty: " />
                    <p:inputText value="#{fakturaView.selected.terminzaplaty}" required="true" label="text" style="font-weight: bolder;"/>  
                    <h:outputLabel value="sposób zapłaty: " />
                    <h:selectOneMenu value="#{fakturaView.selected.sposobzaplaty}" >
                        <f:selectItem itemLabel="przelew" itemValue="przelew"/>
                        <f:selectItem itemLabel="gotówka" itemValue="gotówka"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="konto bankowe: " />
                    <p:inplace id="kontobankowe" editor="true" saveLabel="zachowaj wprowadzoną wartość" cancelLabel="wycofaj wprowadzone zmiany">  
                        <p:inputText value="#{fakturaView.selected.nrkontabankowego}" required="true" label="text" style="font-weight: bolder;" requiredMessage="Brakuje wpisanego numeru konta bankowego"/>  
                    </p:inplace>
                    <h:outputLabel value="waluta faktury: " />
                    <h:selectOneMenu value="#{fakturaView.selected.walutafaktury}" >
                        <f:selectItem itemLabel="PLN" itemValue="PLN"/>
                        <f:selectItem itemLabel="EUR" itemValue="EUR"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="dane kontrahenta: " />
                    <p:autoComplete id="acForce" value="#{fakturaView.selected.kontrahent}" completeMethod="#{KlView.complete}"
                                    var="p" itemLabel="#{p.npelna}" itemValue="#{p}" converter="KlientConv" title="wpisz nazwę lub nip kontrahenta"
                                    minQueryLength="3" maxResults="10" maxlength="10" converterMessage="Nieudana konwersja Klient"
                                    autocomplete="true" forceSelection="true" 
                                    required="true" requiredMessage="Dane klienta niedawno edytowane" queryDelay="10" >
                        <f:ajax event="blur" listener="#{fakturaView.wgenerujnumerfaktury}" execute="@this" />
                        <f:facet name="itemtip">  
                            <h:panelGrid  columns="2" cellpadding="5" width="400">  
                                <f:facet name="header">  
                                    <h:outputText value="Dane kontrahenta"/>
                                </f:facet>  
                                <h:outputText value="Nazwa: " />  
                                <h:outputText id="npelna" value="#{p.npelna}" />  
                                <h:outputText value="NIP: " />  
                                <h:outputText id="nip" value="#{p.nip}" />  
                                <h:outputText value="Adres " />  
                                <h:outputText id="klumna" value="#{p.miejscowosc} #{p.ulica} #{p.dom} #{p.lokal}" />
                                <h:outputText value="Email " />  
                                <h:outputText id="kemail" value="#{p.email}" /> 
                            </h:panelGrid>
                        </f:facet>
                        <f:param name="passedValue" value="#{p}" />
                    </p:autoComplete>
                    <h:outputLabel value="wystawiający fakturę: " />
                    <p:inplace id="wystawiajacyfakt" editor="true" saveLabel="zachowaj wprowadzoną wartość" cancelLabel="wycofaj wprowadzone zmiany">  
                        <p:inputText value="#{fakturaView.selected.podpis}" required="true" label="text" style="font-weight: bolder;"/>  
                    </p:inplace>
                </p:panelGrid>
                <br/>
                <p:outputPanel id="panel" style="margin-top: 15px;">
                    <p:outputLabel value="nazwa" style="margin-right: 135px; font-weight: bolder;"/>
                    <p:outputLabel value="pkwiu" style="margin-right: 125px; font-weight: bolder;"/>
                    <p:outputLabel value="jednosta miary" style="margin-right: 70px; font-weight: bolder;"/>
                    <p:outputLabel value="ilość" style="margin-right: 135px; font-weight: bolder;"/>
                    <p:outputLabel value="cena jednostkowa" style="margin-right: 45px; font-weight: bolder;"/>
                    <p:outputLabel value="stawka podatku VAT" style="font-weight: bolder;"/>
                    <p:dataTable id="rzad" value="#{fakturaView.pozycje}" var="row" rowIndexVar="rowStat" style="width: 70%;">
                        <p:column headerText="nazwa">
                            <p:inputText id="nazwa" value="#{row.nazwa}" styleClass="komorka"  label="text" title="nazwa towaru lub usługi" ><p:watermark for="nazwa" value="nazwa towaru lub usługi" /></p:inputText>   
                        </p:column>
                        <p:column headerText="pkwiu">
                            <p:inputText id="pkwiu" value="#{row.PKWiU}" label="text" title="jednostka miary"><p:watermark for="pkwiu" value="symbol PKWiU" /></p:inputText>    
                        </p:column>
                        <p:column headerText="jednosta miary">
                            <h:selectOneMenu id="jednmiary" value="#{row.jednostka}" title="stawka podatku VAT" style="width: 150px;">
                                <f:selectItem itemLabel="szt." itemValue="szt."/>
                                <f:selectItem itemLabel="kg" itemValue="kg"/>
                                <f:selectItem itemLabel="kpl" itemValue="kpl"/>
                                <f:selectItem itemLabel="m-c" itemValue="m-c"/>
                                <f:selectItem itemLabel="osb." itemValue="osb."/>
                            </h:selectOneMenu>
                        </p:column>
                        <p:column headerText="ilość">
                            <p:inputText id="ilosc" value="#{row.ilosc}" label="text" title="ilość" style="text-align:  right;"><p:watermark for="ilosc" value="ilość" /></p:inputText>
                        </p:column>
                        <p:column headerText="cena jednostkowa">
                            <pe:inputNumber id="cena" value="#{row.cena}" required="true" requiredMessage="Brak kwoty - uzupełnij" symbolPosition="s" decimalSeparator="." thousandSeparator=" " decimalPlaces="2" minValue="-10000000"/> 
                        </p:column>
                        <p:column headerText="stawka podatku VAT">
                            <h:selectOneMenu id="podatek" value="#{row.podatek}" title="stawka podatku VAT" style="width: 150px;" >
                                <f:selectItem itemLabel="23%" itemValue="23"/>
                                <f:selectItem itemLabel="8%" itemValue="8"/>
                                <f:selectItem itemLabel="5%" itemValue="5"/>
                                <f:selectItem itemLabel="0%" itemValue="0"/>
                            </h:selectOneMenu>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
                <br/>
                <p:outputPanel  style="margin-top: 25px;">
                    <p:commandButton id="dodkol" value="dodaj wiersz" actionListener="#{fakturaView.dodajwiersz()}" oncomplete="wybierzrzadfaktury();" style="margin-bottom: 25px;"/>
                    <p:commandButton id="usunkol" value="usuń wiersz" actionListener="#{fakturaView.usunwiersz()}" style="margin-bottom: 25px;"/>
                </p:outputPanel>
                <br/>
                <p:outputPanel  style="margin-top: 15px;">
                    <p:commandButton id="zachowajfakt" value="zachowaj fakture" actionListener="#{fakturaView.dodaj()}" update=":akordeon:formstworz" style="margin-bottom: 25px;"/>
                    <p:commandButton style="margin-left: 25px;" id="dodajwzorcowywiersz" value="wzorcowy wiersz" actionListener="#{fakturaView.zachowajwierszwzorcowy()}"/>
                </p:outputPanel>
            </p:outputPanel>
        </h:form>
    </p:tab>  
</ui:composition>   


